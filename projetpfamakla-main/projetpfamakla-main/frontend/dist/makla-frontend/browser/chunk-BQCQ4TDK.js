import{a as g}from"./chunk-2LUDLJ2U.js";import{A as r,M as c,Q as m,U as p,Xb as f,k as h,n as s,r as u}from"./chunk-OOT27GPI.js";var $=(()=>{let n=class n{constructor(e){this.http=e,this.baseUrl=`${g.apiUrl}/enhanced`,this.fastTimeout=15e3,this.healthScoreSubject=new h(70),this.healthScore$=this.healthScoreSubject.asObservable(),this.alertsSubject=new h([]),this.alerts$=this.alertsSubject.asObservable(),this.loadingSubject=new h(!1),this.loading$=this.loadingSubject.asObservable(),this.cache=new Map,this.cacheTimeout=6e4}quickAnalyze(e,t=!1,i){let a=`quick-${JSON.stringify(e)}-${t}`;if(this.cache.has(a))return s(this.cache.get(a));this.loadingSubject.next(!0);let l={userData:JSON.stringify(e),isDiabetic:t,userProfile:i};return console.debug("[EnhancedAiService] POST quick-analyze payload:",l),this.http.post(`${this.baseUrl}/quick-analyze`,l).pipe(u(this.fastTimeout),c(o=>{o.healthScore&&this.healthScoreSubject.next(o.healthScore),this.cache.set(a,o),setTimeout(()=>this.cache.delete(a),this.cacheTimeout),this.loadingSubject.next(!1)}),r(o=>(console.error("Quick analysis failed:",o),this.loadingSubject.next(!1),s({healthScore:70,topAlert:"Keep tracking your meals!",quickTip:t?"Monitor carb intake":"Stay hydrated",success:!1}))))}smartMealLog(e,t=!1,i){this.loadingSubject.next(!0);let a={description:e,isDiabetic:t,userProfile:i};return console.debug("[EnhancedAiService] POST smart-meal-log payload:",a),this.http.post(`${this.baseUrl}/smart-meal-log`,a).pipe(u(8e3),c(()=>this.loadingSubject.next(!1)),r(l=>(console.error("Smart meal log failed:",l),this.loadingSubject.next(!1),s(this.getDefaultMealEstimate(e,t)))))}diabeticMonitor(e,t,i=0){return this.http.post(`${this.baseUrl}/diabetic-monitor`,{todayData:JSON.stringify(e),totalCarbs:t,glucoseLevel:i}).pipe(c(a=>{a.alerts&&a.alerts.length>0&&this.alertsSubject.next(a.alerts)}),r(a=>(console.error("Diabetic monitoring failed:",a),s(this.getDefaultMonitoring(t)))))}getDiabeticMeals(e,t){let i={remainingCarbs:e,userProfile:t};return console.debug("[EnhancedAiService] POST diabetic/meals payload:",i),this.http.post(`${this.baseUrl}/diabetic/meals`,i).pipe(r(()=>s({meals:[],success:!1})))}getWeeklyTrends(e,t=!1){let i=`trends-${t}`;return this.cache.has(i)?s(this.cache.get(i)):this.http.post(`${this.baseUrl}/weekly-trends`,{weekData:JSON.stringify(e),isDiabetic:t}).pipe(c(a=>{this.cache.set(i,a),setTimeout(()=>this.cache.delete(i),this.cacheTimeout)}),r(a=>(console.error("Weekly trends failed:",a),s({success:!1}))))}recognizeFood(e){return this.http.post(`${this.baseUrl}/recognize-food`,{description:e}).pipe(u(1e4),r(t=>(console.error("Food recognition failed:",t),s({success:!1,error:"Recognition unavailable"}))))}clearAlerts(){this.alertsSubject.next([])}dismissAlert(e){let i=this.alertsSubject.value.filter(a=>a!==e);this.alertsSubject.next(i)}getDefaultMealEstimate(e,t){return{name:e,calories:400,protein:20,carbs:40,fats:15,fiber:5,netCarbs:35,glycemicLoad:"medium",healthScore:60,isDiabeticFriendly:!1,diabeticWarning:t?"Estimated values - track carefully":void 0}}getDefaultMonitoring(e){let t=[];return e>130&&t.push({type:"danger",title:"\u26A0\uFE0F High Carb Intake",message:`You've exceeded recommended daily carbs (${e}g/130g)`,action:"REDUCE_CARBS"}),{alerts:t,carbsPercent:Math.min(100,e*100/130),status:e>130?"danger":e>100?"warning":"good",recommendations:["Focus on protein and vegetables","Stay hydrated","Consider a short walk after meals"]}}getDefaultDiabeticMeals(){return[{name:"Grilled Chicken Salad",netCarbs:8,protein:35,fiber:6,diabeticScore:95},{name:"Salmon with Broccoli",netCarbs:12,protein:40,fiber:5,diabeticScore:92},{name:"Egg Omelet with Veggies",netCarbs:5,protein:25,fiber:4,diabeticScore:90}]}generateNutritionInsights(e,t){return this.http.post(`${this.baseUrl}/nutrition/insights`,{userData:e,isDiabetic:t}).pipe(r(()=>s({insights:[],success:!1})))}calculateWaterRecommendations(e,t,i){return this.http.post(`${this.baseUrl}/water/recommendations`,{userData:e,activityLevel:t,currentWater:i}).pipe(r(()=>s({recommendedTotal:2500,currentIntake:i,deficit:Math.max(0,2500-i),success:!1})))}};n.\u0275fac=function(t){return new(t||n)(p(f))},n.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"});let d=n;return d})();export{$ as a};
