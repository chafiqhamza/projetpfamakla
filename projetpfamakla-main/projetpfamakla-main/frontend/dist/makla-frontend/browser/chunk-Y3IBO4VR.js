import{a as b}from"./chunk-2LUDLJ2U.js";import{M as h,Q as y,U as S,Xb as p,a as d,k as c}from"./chunk-OOT27GPI.js";var T=(()=>{let o=class o{constructor(e){this.http=e,this.baseUrl=b.apiUrl,this.aiServiceUrl=b.aiServiceUrl,this.goalsSubject=new c({calories:2e3,water:2500,carbs:250,protein:60,fat:65,fiber:30}),this.goals$=this.goalsSubject.asObservable(),this.historySubject=new c([]),this.history$=this.historySubject.asObservable(),this.loadingSubject=new c(!1),this.loading$=this.loadingSubject.asObservable(),this.loadGoalsFromStorage()}getCurrentGoals(){return this.goalsSubject.value}updateGoals(e,t="Manual update"){let s=this.goalsSubject.value,a=d(d({},s),e);this.addToHistory(s,a,t,"USER"),this.goalsSubject.next(a),this.saveGoalsToStorage(a)}requestAIAnalysis(e,t){return this.loadingSubject.next(!0),this.http.post(`${this.aiServiceUrl}/agent/analyze-profile`,{userProfile:e,currentData:t}).pipe(h(s=>{this.loadingSubject.next(!1),console.log("AI Analysis received:",s)}))}applyAISuggestedGoals(e,t,s,a){return this.loadingSubject.next(!0),this.http.post(`${this.aiServiceUrl}/agent/update-goals`,{userId:e,newGoals:t,accepted:s,feedback:a}).pipe(h(i=>{if(i.success&&s){let r=this.goalsSubject.value;this.addToHistory(r,t,"AI Agent recommendation","AI_AGENT"),this.goalsSubject.next(t),this.saveGoalsToStorage(t),this.syncWithUserService(e,t).subscribe(()=>console.log("Goals synced with user service"),l=>console.error("Failed to sync with user service:",l))}this.loadingSubject.next(!1)}))}syncWithUserService(e,t){return this.http.put(`${this.baseUrl}/users/${e}/goals`,{dailyCalorieGoal:t.calories,dailyWaterGoal:t.water,dailyCarbLimit:t.carbs,dailyProteinGoal:t.protein,dailyFatGoal:t.fat,dailyFiberGoal:t.fiber})}loadGoalsFromUserService(e){return this.loadingSubject.next(!0),this.http.get(`${this.baseUrl}/users/${e}/profile`).pipe(h(t=>{if(t){let s={calories:t.dailyCalorieGoal||2e3,water:t.dailyWaterGoal||2500,carbs:t.dailyCarbLimit||250,protein:t.dailyProteinGoal||60,fat:t.dailyFatGoal||65,fiber:t.dailyFiberGoal||30};this.goalsSubject.next(s),this.saveGoalsToStorage(s)}this.loadingSubject.next(!1)}))}calculateGoalsFromProfile(e){let t=e.age||30,s=e.weight||70,a=e.height||170,i=e.gender||"MALE",r=e.activityLevel||"MODERATE",l=10*s+6.25*a-5*t;i==="MALE"?l+=5:l-=161;let v=l*({SEDENTARY:1.2,LIGHT:1.375,MODERATE:1.55,ACTIVE:1.725,VERY_ACTIVE:1.9}[r]||1.55),n=Math.round(v),g=e.healthConditions&&e.healthConditions.some(m=>m.toLowerCase().includes("diabet"));return{calories:n,water:Math.round(s*35),carbs:g?130:Math.round(n*.5/4),protein:Math.round(n*.2/4),fat:Math.round(n*.3/9),fiber:g?35:30}}resetToDefaults(){let e={calories:2e3,water:2500,carbs:250,protein:60,fat:65,fiber:30};this.updateGoals(e,"Reset to defaults")}addToHistory(e,t,s,a){let i=this.historySubject.value,r={timestamp:new Date,previousGoals:e,newGoals:t,reason:s,source:a};i.unshift(r),i.length>20&&i.pop(),this.historySubject.next(i),localStorage.setItem("goals-history",JSON.stringify(i))}saveGoalsToStorage(e){localStorage.setItem("nutrition-goals",JSON.stringify(e))}loadGoalsFromStorage(){let e=localStorage.getItem("nutrition-goals");if(e)try{let s=JSON.parse(e);this.goalsSubject.next(s)}catch(s){console.error("Failed to parse stored goals",s)}let t=localStorage.getItem("goals-history");if(t)try{let s=JSON.parse(t);this.historySubject.next(s)}catch(s){console.error("Failed to parse goals history",s)}}clearHistory(){this.historySubject.next([]),localStorage.removeItem("goals-history")}};o.\u0275fac=function(t){return new(t||o)(S(p))},o.\u0275prov=y({token:o,factory:o.\u0275fac,providedIn:"root"});let u=o;return u})();export{T as a};
