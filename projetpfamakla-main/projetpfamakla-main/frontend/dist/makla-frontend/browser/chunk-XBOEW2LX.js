import{a as C}from"./chunk-Y3IBO4VR.js";import{a as k}from"./chunk-2LUDLJ2U.js";import{A as n,Ba as y,M as p,Q as b,U as f,Xb as w,a as g,k as u,n as l,s as d}from"./chunk-OOT27GPI.js";var E=(()=>{let h=class h{constructor(i,t){this.http=i,this.goalsSyncService=t,this.baseUrl=k.aiServiceUrl,this.agentActiveSubject=new u(!1),this.agentActive$=this.agentActiveSubject.asObservable(),this.analysisSubject=new u(null),this.analysis$=this.analysisSubject.asObservable(),this.alertsSubject=new u([]),this.alerts$=this.alertsSubject.asObservable(),this.dashboardUpdate=new y,this.goalsSubject=new u({calories:2e3,water:2500,carbs:250}),this.goals$=this.goalsSubject.asObservable(),this.userProfile={},this.userProfileSubject=new u({}),this.userProfile$=this.userProfileSubject.asObservable(),this.diabeticFriendlyFoods=[{name:"Grilled Chicken Breast",portion:"150g",calories:165,carbs:0,protein:31,fat:3.6,glycemicIndex:"low"},{name:"Salmon Fillet",portion:"150g",calories:280,carbs:0,protein:39,fat:13,glycemicIndex:"low"},{name:"Broccoli (steamed)",portion:"100g",calories:35,carbs:7,protein:2.4,fat:.4,fiber:2.6,glycemicIndex:"low"},{name:"Spinach Salad",portion:"100g",calories:23,carbs:3.6,protein:2.9,fat:.4,fiber:2.2,glycemicIndex:"low"},{name:"Quinoa",portion:"100g",calories:120,carbs:21,protein:4.4,fat:1.9,fiber:2.8,glycemicIndex:"low"},{name:"Brown Rice",portion:"100g",calories:112,carbs:24,protein:2.3,fat:.8,fiber:1.8,glycemicIndex:"medium"},{name:"Lentils",portion:"100g",calories:116,carbs:20,protein:9,fat:.4,fiber:8,glycemicIndex:"low"},{name:"Greek Yogurt (unsweetened)",portion:"150g",calories:100,carbs:6,protein:17,fat:.7,glycemicIndex:"low"},{name:"Almonds",portion:"30g",calories:170,carbs:6,protein:6,fat:15,fiber:3.5,glycemicIndex:"low"},{name:"Avocado",portion:"100g",calories:160,carbs:9,protein:2,fat:15,fiber:7,glycemicIndex:"low"},{name:"Eggs (boiled)",portion:"2 large",calories:140,carbs:1,protein:12,fat:10,glycemicIndex:"low"},{name:"Cauliflower Rice",portion:"100g",calories:25,carbs:5,protein:2,fat:.3,fiber:2,glycemicIndex:"low"},{name:"Zucchini",portion:"100g",calories:17,carbs:3,protein:1.2,fat:.3,fiber:1,glycemicIndex:"low"},{name:"Turkey Breast",portion:"150g",calories:135,carbs:0,protein:30,fat:1,glycemicIndex:"low"},{name:"Cottage Cheese",portion:"100g",calories:98,carbs:3.4,protein:11,fat:4.3,glycemicIndex:"low"},{name:"Olive Oil",portion:"1 tbsp",calories:120,carbs:0,protein:0,fat:14,glycemicIndex:"low"},{name:"Bell Peppers",portion:"100g",calories:31,carbs:6,protein:1,fat:.3,fiber:2.1,glycemicIndex:"low"},{name:"Mushrooms",portion:"100g",calories:22,carbs:3.3,protein:3.1,fat:.3,fiber:1,glycemicIndex:"low"},{name:"Green Beans",portion:"100g",calories:31,carbs:7,protein:1.8,fat:.1,fiber:3.4,glycemicIndex:"low"},{name:"Tofu",portion:"100g",calories:76,carbs:1.9,protein:8,fat:4.8,glycemicIndex:"low"}]}activateAgent(){this.agentActiveSubject.next(!0)}deactivateAgent(){this.agentActiveSubject.next(!1)}updateUserProfile(i){if(this.userProfile=g(g({},this.userProfile),i),this.userProfileSubject.next(this.userProfile),i.healthConditions?.includes("Diabetic")){this.userProfile.dailyCarbLimit=130,this.userProfile.dailyCalorieGoal=i.dailyCalorieGoal||1800,this.goalsSubject.next({calories:this.userProfile.dailyCalorieGoal,water:2500,carbs:130});let t={type:"UPDATE_GOALS",data:this.goalsSubject.value};this.dashboardUpdate.emit(t),this.goalsSyncService.updateGoals({calories:this.userProfile.dailyCalorieGoal,water:2500,carbs:130},"AI Agent Profile Update (Diabetic Mode)")}}getUserProfile(){return this.userProfile}isDiabetic(){return this.userProfile.healthConditions?.includes("Diabetic")||!1}generateDiabeticMealPlan(i){let t=[];return!i||i==="dinner"?t.push({name:"\u{1F957} Grilled Salmon with Roasted Vegetables",foods:[this.diabeticFriendlyFoods.find(e=>e.name==="Salmon Fillet"),this.diabeticFriendlyFoods.find(e=>e.name==="Broccoli (steamed)"),this.diabeticFriendlyFoods.find(e=>e.name==="Bell Peppers"),this.diabeticFriendlyFoods.find(e=>e.name==="Olive Oil")],totalCalories:466,totalCarbs:13,totalProtein:42,totalFat:28,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"30 minutes",recipe:`**Ingredients:**
\u2022 150g salmon fillet
\u2022 100g broccoli florets
\u2022 1 bell pepper, sliced
\u2022 1 tbsp olive oil
\u2022 Lemon, garlic, herbs

**Instructions:**
1. Preheat oven to 200\xB0C (400\xB0F)
2. Season salmon with lemon, garlic, salt & pepper
3. Toss vegetables with olive oil and herbs
4. Bake salmon for 15 min, vegetables for 20 min
5. Serve with a squeeze of fresh lemon

**Why it's good for diabetics:**
\u2705 High protein, very low carbs
\u2705 Omega-3 fatty acids help insulin sensitivity
\u2705 Low glycemic index vegetables`,tips:"\u{1F4A1} Omega-3 in salmon helps improve insulin sensitivity!"},{name:"\u{1F357} Herb Chicken with Cauliflower Rice",foods:[this.diabeticFriendlyFoods.find(e=>e.name==="Grilled Chicken Breast"),this.diabeticFriendlyFoods.find(e=>e.name==="Cauliflower Rice"),this.diabeticFriendlyFoods.find(e=>e.name==="Spinach Salad"),this.diabeticFriendlyFoods.find(e=>e.name==="Olive Oil")],totalCalories:343,totalCarbs:12,totalProtein:36,totalFat:18,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"25 minutes",recipe:`**Ingredients:**
\u2022 150g chicken breast
\u2022 100g cauliflower rice
\u2022 100g fresh spinach
\u2022 1 tbsp olive oil
\u2022 Italian herbs, garlic

**Instructions:**
1. Season chicken with herbs, garlic, salt & pepper
2. Grill chicken 6-7 min per side until cooked
3. Saut\xE9 cauliflower rice in olive oil for 5 min
4. Serve over fresh spinach

**Why it's good for diabetics:**
\u2705 Only 12g carbs total!
\u2705 High protein keeps you full
\u2705 Cauliflower rice is a perfect low-carb substitute`,tips:"\u{1F4A1} Cauliflower rice has 75% fewer carbs than regular rice!"},{name:"\u{1F958} Turkey & Vegetable Stir-Fry",foods:[this.diabeticFriendlyFoods.find(e=>e.name==="Turkey Breast"),this.diabeticFriendlyFoods.find(e=>e.name==="Bell Peppers"),this.diabeticFriendlyFoods.find(e=>e.name==="Mushrooms"),this.diabeticFriendlyFoods.find(e=>e.name==="Green Beans")],totalCalories:219,totalCarbs:16,totalProtein:36,totalFat:2,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"20 minutes",recipe:`**Ingredients:**
\u2022 150g turkey breast, sliced
\u2022 100g bell peppers
\u2022 100g mushrooms
\u2022 100g green beans
\u2022 Low-sodium soy sauce, ginger, garlic

**Instructions:**
1. Slice turkey and vegetables into strips
2. Heat wok/pan over high heat
3. Stir-fry turkey 5 min until browned
4. Add vegetables, cook 5 more min
5. Season with soy sauce, ginger, garlic

**Why it's good for diabetics:**
\u2705 Very low fat and low carb
\u2705 High fiber from vegetables
\u2705 No blood sugar spikes`,tips:"\u{1F4A1} Use low-sodium soy sauce to keep sodium in check!"},{name:"\u{1F95A} Veggie Omelette with Avocado",foods:[this.diabeticFriendlyFoods.find(e=>e.name==="Eggs (boiled)"),this.diabeticFriendlyFoods.find(e=>e.name==="Spinach Salad"),this.diabeticFriendlyFoods.find(e=>e.name==="Mushrooms"),this.diabeticFriendlyFoods.find(e=>e.name==="Avocado")],totalCalories:345,totalCarbs:16,totalProtein:19,totalFat:26,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"15 minutes",recipe:`**Ingredients:**
\u2022 2 large eggs
\u2022 50g spinach
\u2022 50g mushrooms
\u2022 1/2 avocado
\u2022 Salt, pepper, herbs

**Instructions:**
1. Whisk eggs with salt and pepper
2. Saut\xE9 mushrooms and spinach
3. Pour eggs over vegetables
4. Cook until set, fold in half
5. Serve with sliced avocado

**Why it's good for diabetics:**
\u2705 Eggs don't raise blood sugar
\u2705 Healthy fats from avocado
\u2705 Quick and satisfying`,tips:"\u{1F4A1} Eggs are one of the best foods for diabetics - high protein, zero carbs!"},{name:"\u{1F41F} Lemon Herb Cod with Quinoa",foods:[{name:"Cod Fillet",portion:"150g",calories:140,carbs:0,protein:32,fat:1,glycemicIndex:"low"},this.diabeticFriendlyFoods.find(e=>e.name==="Quinoa"),this.diabeticFriendlyFoods.find(e=>e.name==="Zucchini")],totalCalories:282,totalCarbs:29,totalProtein:38,totalFat:3,glycemicIndex:"low-medium",diabeticFriendly:!0,prepTime:"25 minutes",recipe:`**Ingredients:**
\u2022 150g cod fillet
\u2022 100g quinoa (cooked)
\u2022 100g zucchini
\u2022 Lemon, dill, olive oil

**Instructions:**
1. Cook quinoa according to package
2. Season cod with lemon, dill, salt
3. Bake cod at 180\xB0C for 15 min
4. Saut\xE9 zucchini with olive oil
5. Plate quinoa, top with cod and zucchini

**Why it's good for diabetics:**
\u2705 Quinoa has low glycemic index
\u2705 High protein fish
\u2705 Balanced macros`,tips:"\u{1F4A1} Quinoa is a complete protein and has a lower GI than rice!"}):i==="breakfast"?t.push({name:"\u{1F963} Oatmeal with Berries",foods:[{name:"Oats",portion:"50g",calories:190,carbs:34,protein:6,fat:3},{name:"Mixed Berries",portion:"100g",calories:50,carbs:12,protein:1,fat:0},{name:"Almonds",portion:"15g",calories:85,carbs:3,protein:3,fat:7}],totalCalories:325,totalCarbs:49,totalProtein:10,totalFat:10,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"10 minutes",recipe:`**Ingredients:**
\u2022 50g oats
\u2022 100g berries
\u2022 15g almonds
**Instructions:**
Cook oats with water or milk. Top with berries and nuts.`,tips:"\u{1F4A1} Oats are great for stable energy!"},{name:"\u{1F373} Spinach & Mushroom Omelette",foods:[{name:"Eggs",portion:"2 large",calories:140,carbs:1,protein:12,fat:10},{name:"Spinach",portion:"1 cup",calories:7,carbs:1,protein:1,fat:0},{name:"Mushrooms",portion:"1/2 cup",calories:15,carbs:2,protein:2,fat:0}],totalCalories:162,totalCarbs:4,totalProtein:15,totalFat:10,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"15 minutes",recipe:`**Ingredients:**
\u2022 2 eggs
\u2022 Spinach & Mushrooms
**Instructions:**
Whisk eggs. Saut\xE9 veggies. Cook together.`,tips:"\u{1F4A1} High protein, very low carb start to the day."}):i==="lunch"&&t.push({name:"\u{1F957} Grilled Chicken Salad",foods:[{name:"Chicken Breast",portion:"150g",calories:165,carbs:0,protein:31,fat:3},{name:"Mixed Greens",portion:"2 cups",calories:20,carbs:4,protein:2,fat:0},{name:"Olive Oil Dressing",portion:"1 tbsp",calories:120,carbs:0,protein:0,fat:14}],totalCalories:305,totalCarbs:4,totalProtein:33,totalFat:17,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"15 minutes",recipe:`**Ingredients:**
\u2022 Chicken breast
\u2022 Greens
\u2022 Dressing
**Instructions:**
Grill chicken. Toss salad.`,tips:"\u{1F4A1} Perfect light lunch for stable blood sugar."},{name:"\u{1F959} Quinoa & Black Bean Bowl",foods:[{name:"Quinoa",portion:"1/2 cup",calories:111,carbs:20,protein:4,fat:2},{name:"Black Beans",portion:"1/2 cup",calories:114,carbs:20,protein:7,fat:0},{name:"Avocado",portion:"1/4",calories:80,carbs:4,protein:1,fat:7}],totalCalories:305,totalCarbs:44,totalProtein:12,totalFat:9,glycemicIndex:"low",diabeticFriendly:!0,prepTime:"10 minutes (precooked)",recipe:`**Ingredients:**
\u2022 Quinoa
\u2022 Black Beans
\u2022 Avocado
**Instructions:**
Mix ingredients in a bowl.`,tips:"\u{1F4A1} High fiber content helps manage blood sugar spikes."}),l(t)}updateDashboard(i,t){let e={type:i,data:t};console.log("AiService: Emitting dashboard update",e),this.dashboardUpdate.emit(e)}refreshDashboardData(){let i={type:"REFRESH_DATA"};console.log("AiService: Emitting REFRESH_DATA"),this.dashboardUpdate.emit(i)}getSmartFoodSuggestions(i,t){let e=[...this.diabeticFriendlyFoods];return(t==="Diabetic"||this.isDiabetic())&&(e=e.filter(a=>a.glycemicIndex==="low")),i&&i.length>0&&i.forEach(a=>{e.find(s=>s.name.toLowerCase()===a.name?.toLowerCase())||(a.sugar||0)<10&&(a.carbohydrates||0)<30&&e.push({name:a.name,portion:"100g",calories:a.calories||0,carbs:a.carbohydrates||0,protein:a.protein||0,fat:a.fat||0,fiber:a.fiber,sugar:a.sugar,glycemicIndex:(a.sugar||0)<5?"low":"medium"})}),e}chat(i){let t={message:i};return this.http.post(`${this.baseUrl}/chat/rag`,t).pipe(d(e=>{if(!e)return"";if(typeof e=="string")return e;if(e.response)return e.response;let a=Object.keys(e);for(let s of a)if(typeof e[s]=="string")return e[s];return JSON.stringify(e)}),n(e=>(console.warn("Error with RAG chat, falling back to simple chat: ",e),this.http.post(`${this.baseUrl}/chat`,t).pipe(d(a=>a&&(a.response||a)?a.response||a:JSON.stringify(a)),n(a=>(console.warn("Fallback simple chat failed, returning local reply",a),l(`[Local fallback] Sorry, AI is currently unavailable. You said: ${i}`)))))))}chatWithRag(i,t){let e={message:i,context:t};return this.http.post(`${this.baseUrl}/chat/rag`,e).pipe(d(a=>({role:"assistant",content:a.response||"No response from AI",timestamp:new Date,actions:this.extractActionsFromIntent(a.intent,a.suggestedActions)})),n(a=>(console.error("Error with RAG chat, falling back to simple chat:",a),this.chatWithPhi3(i,t))))}extractActionsFromIntent(i,t){let e=[];if(!t||t.length===0)return e;for(let a of t)switch(a){case"suggest_meals":e.push({type:"GET_SUGGESTIONS",parameters:{mealType:"any"},status:"pending",label:"\u{1F37D}\uFE0F Sugg\xE9rer des repas"});break;case"log_meal":e.push({type:"ADD_MEAL",parameters:{},status:"pending",label:"\u{1F4DD} Enregistrer un repas"});break;case"add_water":e.push({type:"ADD_WATER",parameters:{amount:250},status:"pending",label:"\u{1F4A7} Ajouter de l'eau"});break;case"analyze_profile":e.push({type:"UPDATE_DASHBOARD",parameters:{action:"analyze"},status:"pending",label:"\u{1F4CA} Analyser mon profil"});break;case"update_goals":e.push({type:"SET_GOAL",parameters:{},status:"pending",label:"\u{1F3AF} Mettre \xE0 jour mes objectifs"});break}return e}chatLegacy(i,t){let e={message:i};return t&&(e.context=t),this.http.post(`${this.baseUrl}/chat/rag`,e).pipe(p(a=>{this.processAiResponse(a.response,i)}),n(a=>{console.warn("Chat backend failed, using local response:",a);let s=this.getFallbackResponse(i);return this.processAiResponse(s,i),l({response:s})}))}getFallbackResponse(i){return this.generateLocalResponse(i)}chatWithPhi3(i,t){let e={message:i,context:t};return this.http.post(`${this.baseUrl}/chat/rag`,e).pipe(d(a=>({role:"assistant",content:a.response||"No response from AI",timestamp:new Date})),n(a=>(console.error("Error chatting with Phi3:",a),l({role:"assistant",content:"I'm having trouble connecting to Phi3 right now. Please ensure Ollama is running with the phi3 model.",timestamp:new Date}))))}smartChatWithPhi3(i,t){let e={message:i,context:t};return this.http.post(`${this.baseUrl}/smart/chat`,e).pipe(d(a=>{let s={role:"assistant",content:a.response||"No response from AI",timestamp:new Date},r=[];if(a.actionData){let o=a.actionData;a.intent==="LOG_MEAL"&&o.mealName?r.push({type:"ADD_MEAL",parameters:{name:o.mealName,calories:o.calories||300,protein:o.protein||0,carbs:o.carbs||0,fats:o.fats||0,fiber:o.fiber||0},status:"pending"}):a.intent==="LOG_WATER"&&(o.glasses||o.waterAmount)&&r.push({type:"ADD_WATER",parameters:{amount:o.waterAmount||o.glasses*250||250},status:"pending"})}return s.actions=r,{response:s,actions:r,actionData:a.actionData}}),n(a=>{console.error("Error with smart chat:",a);let s={role:"assistant",content:this.getFallbackResponse(i),timestamp:new Date};return l({response:s,actions:[]})}))}generateDiagnosticWithPhi3(i){return this.http.post(`${this.baseUrl}/smart/diagnostic`,{userData:i}).pipe(d(t=>t.report||"Unable to generate report"),n(t=>(console.error("Error generating diagnostic:",t),l("Diagnostic report is temporarily unavailable. Please ensure the AI service is running."))))}testPhi3Connection(){return this.http.post(`${this.baseUrl}/chat/rag`,{message:"Hello, are you working?"}).pipe(d(i=>(console.log("Phi3 connection test successful:",i),!0)),n(i=>(console.error("Phi3 connection test failed:",i),l(!1))))}quickAnalyzeWithPhi3(i,t=!1){return this.http.post(`${this.baseUrl}/enhanced/quick-analyze`,{userData:i,isDiabetic:t}).pipe(n(e=>(console.error("Error with quick analyze:",e),l({success:!1,insights:["Unable to connect to AI service"],recommendations:["Please check if Ollama is running with phi3 model"]}))))}smartMealLogWithPhi3(i,t=!1){return this.http.post(`${this.baseUrl}/enhanced/smart-meal-log`,{description:i,isDiabetic:t}).pipe(n(e=>(console.error("Error with smart meal log:",e),l({success:!1,message:"Unable to log meal automatically"}))))}autoAct(i,t=!1){let e={userData:i,isDiabetic:t};return this.http.post(`${this.baseUrl}/enhanced/auto-act`,e).pipe(n(a=>{console.warn("autoAct backend failed, returning local auto actions:",a);let s={success:!1};try{let r=i?.water?Math.max(0,2e3-i.water):2e3;r>0&&(s.water={type:"remind_water",amount_ml:Math.min(500,r),message:"\u{1F4A7} Add a glass of water"});let o=i?.carbs||0;t&&o>130&&(s.carbs={type:"suggest_low_carb_meals",remainingCarbs:Math.max(0,130-o),suggestions:[]}),(i?.protein||0)<30&&(s.protein={type:"tip_add_protein",message:"\u{1F357} Try a protein-rich snack."}),s.success=!0}catch{s.success=!1}return l(s)}))}processNaturalLanguage(i){return this.smartChatWithPhi3(i).pipe(d(t=>({response:t.response.content,actions:t.actions||[]})))}processAiResponse(i,t){let e=t.toLowerCase(),a=i.toLowerCase();if(e.includes("ate")||e.includes("had")||e.includes("meal")){let s=this.extractMealDataFromResponse(i,t);s&&this.updateDashboardWithMealData(s)}if(e.includes("water")||e.includes("drink")){let s=this.extractWaterFromResponse(i,t);s>0&&this.updateDashboardWithWaterData(s)}(a.includes("health")||a.includes("nutrition"))&&this.updateHealthInsights(i)}extractMealDataFromResponse(i,t){let e=this.extractFoodsFromCommand(t);if(e.length>0){let a=this.estimateCalories(e),s=this.estimateCarbs(e),r=this.estimateProtein(e),o=this.estimateFat(e);return{name:e.join(", "),calories:a,carbs:s,protein:r,fat:o,foods:e,aiGenerated:!0,mealTime:this.determineMealTime(),date:new Date().toISOString()}}return null}extractWaterFromResponse(i,t){let e=t.match(/(\d+)\s*(?:ml|liters?|glasses?|cups?)/i);if(e){let a=parseInt(e[1]),s=e[2]?.toLowerCase();return s?.includes("liter")?a*1e3:s?.includes("glass")||s?.includes("cup")?a*250:a}return t.toLowerCase().includes("glass")?250:0}updateDashboardWithMealData(i){this.dashboardUpdate.emit({type:"ADD_MEAL",data:i}),this.updateAnalyticsFromMeal(i)}updateDashboardWithWaterData(i){this.dashboardUpdate.emit({type:"ADD_WATER",data:{amount:i,date:new Date().toISOString()}})}updateHealthInsights(i){let t=this.parseHealthInsights(i);t.length>0&&this.dashboardUpdate.emit({type:"UPDATE_INSIGHTS",data:{insights:t}})}updateAnalyticsFromMeal(i){let t=this.analysisSubject.value;if(t){if(t.insights=t.insights||[],t.insights.push(`Added: ${i.name} (${i.calories} cal)`),t.healthScore!==void 0){let e=this.calculateMealHealthImpact(i);t.healthScore=Math.min(100,t.healthScore+e)}this.analysisSubject.next(t)}}calculateMealHealthImpact(i){let t=0;return i.protein&&i.protein>15&&(t+=5),i.calories&&i.calories<400&&(t+=3),i.foods&&i.foods.some(e=>e.toLowerCase().includes("vegetable")||e.toLowerCase().includes("fruit")||e.toLowerCase().includes("salad"))&&(t+=5),i.calories&&i.calories>600&&(t-=3),i.fat&&i.fat>25&&(t-=2),t}parseHealthInsights(i){let t=[],e=i.split(/[.!?]+/).filter(a=>a.trim());for(let a of e){let s=a.toLowerCase().trim();(s.includes("recommend")||s.includes("suggest")||s.includes("try")||s.includes("consider")||s.includes("good")||s.includes("healthy"))&&t.push(a.trim())}return t.slice(0,3)}determineMealTime(){let i=new Date().getHours();return i<11?"breakfast":i<16?"lunch":"dinner"}estimateProtein(i){let t=0;return i.forEach(e=>{let a=e.toLowerCase();a.includes("chicken")||a.includes("meat")||a.includes("fish")?t+=25:a.includes("egg")?t+=12:a.includes("cheese")||a.includes("yogurt")?t+=10:a.includes("beans")||a.includes("lentil")?t+=8:t+=3}),t||20}estimateFat(i){let t=0;return i.forEach(e=>{let a=e.toLowerCase();a.includes("oil")||a.includes("butter")?t+=14:a.includes("cheese")||a.includes("nuts")?t+=10:a.includes("meat")||a.includes("fish")?t+=8:a.includes("avocado")?t+=15:t+=2}),t||15}generateDiagnostic(i){return this.http.post(`${this.baseUrl}/diagnostic`,i).pipe(n(t=>{console.warn("Diagnostic backend failed, generating local report:",t);let e=this.generateLocalDiagnostic(i);return l(e)}))}analyzeAndAct(i){return this.http.post(`${this.baseUrl}/analyze`,i).pipe(p(t=>{this.analysisSubject.next(t),t.insights&&this.dashboardUpdate.emit({type:"UPDATE_INSIGHTS",data:{insights:t.insights}})}),n(t=>{console.warn("Analysis backend failed, generating local analysis:",t);let e=this.generateLocalAnalysis(i);return this.analysisSubject.next(e),l(e)}))}checkHealthAlerts(i){return this.http.post(`${this.baseUrl}/health-alerts`,i).pipe(p(t=>{let e=Array.isArray(t)?t:[];this.alertsSubject.next(e),e&&e.length>0&&this.dashboardUpdate.emit({type:"SHOW_ALERT",data:e})}),n(t=>{console.warn("Health alerts backend failed, generating local alerts:",t);let e=this.generateLocalHealthAlerts(i);return this.alertsSubject.next(e),e.length>0&&this.dashboardUpdate.emit({type:"SHOW_ALERT",data:e}),l(e)}))}generateLocalHealthAlerts(i){let t=[];return this.isDiabetic()&&(i.todayCarbs>150&&t.push({type:"warning",title:"High Carbohydrate Intake",message:`Your carb intake today (${i.todayCarbs}g) exceeds the recommended limit for diabetics (130g).`,priority:"high"}),i.todayCalories>(this.userProfile.dailyCalorieGoal||1800)*1.2&&t.push({type:"warning",title:"High Calorie Intake",message:"Your calorie intake is significantly above your daily goal.",priority:"medium"})),i.todayWater<1e3&&t.push({type:"info",title:"Low Water Intake",message:"You've had less than 1 liter of water today. Try to increase your hydration.",priority:"medium"}),i.todayCalories<1e3&&t.push({type:"warning",title:"Very Low Calorie Intake",message:"Your calorie intake today is quite low. Make sure you're getting adequate nutrition.",priority:"high"}),t}generateLocalDiagnostic(i){let t={success:!0,timestamp:new Date().toISOString(),userId:i.userId||"anonymous",healthStatus:"normal",recommendations:[],alerts:[],summary:{}},e=i.todayCalories||0,a=i.todayCarbs||0,s=i.todayProtein||0,r=i.todayWater||0,o=this.userProfile.dailyCalorieGoal||2e3,c=2500;return t.summary={calories:{consumed:e,goal:o,percentage:Math.round(e/o*100)},water:{consumed:r,goal:c,percentage:Math.round(r/c*100)},carbs:{consumed:a,limit:this.isDiabetic()?130:250},protein:{consumed:s,goal:150}},t.recommendations=["Continue tracking your meals consistently","Aim for balanced macronutrients in each meal","Stay hydrated throughout the day"],this.isDiabetic()&&(t.recommendations.push("Monitor carbohydrate intake to maintain stable blood sugar"),a>130&&t.alerts.push({type:"warning",message:"Carbohydrate intake exceeds diabetic recommendations",priority:"high"})),r<1500&&t.recommendations.push("Increase water intake - aim for at least 8 glasses per day"),e<o*.7&&t.alerts.push({type:"info",message:"Calorie intake is below recommended levels",priority:"medium"}),t}generateLocalAnalysis(i){let t={success:!0,insights:[],alerts:[],recommendations:[],suggestedActions:[],healthScore:75,motivationalMessage:"Keep up the great work with your nutrition tracking!"},e=50,a=i.todayCalories||0,s=i.todayCarbs||0,r=i.todayProtein||0,o=i.todayWater||0,c=this.userProfile.dailyCalorieGoal||2e3;return o>=2e3?e+=15:o>=1500?e+=10:o>=1e3&&(e+=5),a>c*.8&&a<c*1.2?e+=15:a>c*.6&&a<c*1.4&&(e+=10),r>=100?e+=10:r>=60&&(e+=5),this.isDiabetic()&&(s<=130?e+=10:s<=160?e+=5:e-=5),t.healthScore=Math.min(100,Math.max(0,e)),t.insights=[`Your health score today is ${t.healthScore}/100`,`You've consumed ${a} calories out of your ${c} goal`,`Water intake: ${o}ml (${Math.round(o/2500*100)}% of daily goal)`],this.isDiabetic()&&t.insights.push(`Carbs today: ${s}g (diabetic limit: 130g)`),t.recommendations=["Continue consistent meal tracking","Focus on whole, unprocessed foods","Maintain regular meal timing"],o<2e3&&t.recommendations.push("Increase water intake for better hydration"),r<100&&t.recommendations.push("Add more protein-rich foods to your meals"),t.suggestedActions=[{type:"GET_SUGGESTIONS",parameters:{mealType:this.determineMealTime()},status:"pending",label:"Get meal suggestions"},{type:"ADD_WATER",parameters:{amount:250},status:"pending",label:"Log water intake"}],this.isDiabetic()&&t.suggestedActions.push({type:"CREATE_MEAL_PLAN",parameters:{dietType:"diabetic"},status:"pending",label:"Create diabetic meal plan"}),t.healthScore>=90?t.motivationalMessage="Excellent! You're doing fantastic with your nutrition goals! \u{1F31F}":t.healthScore>=75?t.motivationalMessage="Great job! You're on track with your healthy lifestyle! \u{1F44D}":t.healthScore>=60?t.motivationalMessage="Good progress! A few small adjustments can make a big difference! \u{1F4AA}":t.motivationalMessage="Every step counts! Let's work together to improve your nutrition! \u{1F3AF}",this.isDiabetic()&&s>150&&t.alerts?.push({type:"warning",title:"High Carbohydrate Intake",message:`Your carb intake (${s}g) exceeds the recommended limit for diabetics`,priority:"high"}),a<c*.6&&t.alerts?.push({type:"info",title:"Low Calorie Intake",message:"Consider adding more nutritious foods to meet your calorie goals",priority:"medium"}),t}generateLocalResponse(i,t){let e=i.toLowerCase();if(e.includes("hello")||e.includes("hi")||e.includes("hey"))return"Hello! I'm your AI nutrition assistant. I can help you track meals, analyze your diet, and provide personalized recommendations. What would you like to do today?";if(e.includes("help"))return`I can help you with:
\u2022 \u{1F37D}\uFE0F Log meals: "I ate chicken salad"
\u2022 \u{1F4A7} Track water: "I drank 2 glasses of water"
\u2022 \u{1F4CA} Health analysis: "How am I doing today?"
\u2022 \u{1F957} Meal suggestions: "Suggest a healthy dinner"
\u2022 \u{1FA7A} Health check: "Run a health check"
            
What would you like to try?`;if(e.includes("ate")||e.includes("had")||e.includes("meal")){let a=this.extractFoodsFromCommand(i);return a.length>0?`Great! I've logged your meal: ${a.join(", ")}. I've estimated the nutrition values and updated your dashboard. Your daily totals have been refreshed!`:"I'd be happy to help you log your meal! Can you tell me what specific foods you ate?"}if(e.includes("water")||e.includes("drink")){let a=this.extractWaterFromResponse("",i);return a>0?`Excellent! I've added ${a}ml of water to your daily intake. Stay hydrated! \u{1F4A7}`:"Great job staying hydrated! I've added a glass of water (250ml) to your intake. How much water did you drink?"}return e.includes("health")||e.includes("doing")||e.includes("progress")?`Based on your current data, here's your health summary:
\u2022 Your nutrition tracking is going well!
\u2022 Keep focusing on balanced meals with protein and vegetables
\u2022 Remember to stay hydrated throughout the day
\u2022 I recommend regular meal timing for better metabolism
            
Would you like a detailed health report?`:e.includes("suggest")||e.includes("recommend")||e.includes("meal plan")?this.isDiabetic()?`Here are some diabetes-friendly meal suggestions:
\u2022 \u{1F957} Grilled salmon with roasted vegetables (low-carb)
\u2022 \u{1F357} Herb chicken with cauliflower rice
\u2022 \u{1F95A} Veggie omelette with avocado
\u2022 \u{1F41F} Lemon herb cod with quinoa
                
All meals are designed to maintain stable blood sugar levels!`:`Here are some healthy meal suggestions:
\u2022 \u{1F957} Mediterranean chicken salad
\u2022 \u{1F372} Quinoa Buddha bowl with mixed vegetables  
\u2022 \u{1F41F} Baked salmon with sweet potato
\u2022 \u{1F959} Turkey and avocado wrap
            
Would you like a recipe for any of these?`:"I'm here to help with your nutrition goals! You can ask me to log meals, track water intake, analyze your health, or suggest healthy recipes. What would you like to do?"}extractFoodsFromCommand(i){let t=i.toLowerCase(),e=[],a=[/(?:ate|had|consumed)\s+(.+?)(?:\s+for\s+|\s+at\s+|\s*$)/gi,/(?:chicken|beef|fish|salmon|tuna|turkey|pork|lamb|tofu)/gi,/(?:salad|soup|sandwich|pizza|pasta|rice|quinoa|bread)/gi,/(?:apple|banana|orange|berries|grapes|vegetables|broccoli|spinach)/gi,/(?:cheese|yogurt|milk|eggs|nuts|almonds|avocado)/gi];for(let s of a){let r=i.match(s);r&&e.push(...r.map(o=>o.trim()))}if(e.length===0){let s=t.match(/(?:ate|had|consumed)\s+(.+?)(?:\s+for|\s+at|\.|$)/);if(s){let o=s[1].split(/\s+(?:and|with|,)\s+/);e.push(...o.filter(c=>c.trim().length>2))}}return[...new Set(e.map(s=>s.replace(/^(ate|had|consumed)\s+/i,"").trim()))].filter(s=>s.length>0)}estimateCalories(i){let t=0;return i.forEach(e=>{let a=e.toLowerCase();a.includes("salad")?t+=150:a.includes("chicken")||a.includes("meat")?t+=250:a.includes("fish")||a.includes("salmon")?t+=200:a.includes("pasta")||a.includes("rice")?t+=220:a.includes("sandwich")?t+=300:a.includes("pizza")?t+=285:a.includes("soup")?t+=100:a.includes("fruit")||a.includes("apple")?t+=80:a.includes("yogurt")?t+=120:a.includes("nuts")?t+=160:t+=100}),t||250}estimateCarbs(i){let t=0;return i.forEach(e=>{let a=e.toLowerCase();a.includes("pasta")||a.includes("rice")?t+=45:a.includes("bread")||a.includes("sandwich")?t+=30:a.includes("pizza")?t+=35:a.includes("fruit")||a.includes("apple")?t+=20:a.includes("yogurt")?t+=15:a.includes("salad")?t+=8:a.includes("chicken")||a.includes("meat")||a.includes("fish")?t+=0:t+=10}),t||25}};h.\u0275fac=function(t){return new(t||h)(f(w),f(C))},h.\u0275prov=b({token:h,factory:h.\u0275fac,providedIn:"root"});let m=h;return m})();export{E as a};
