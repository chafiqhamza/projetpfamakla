import{a as se}from"./chunk-SEHQNQMM.js";import{a as oe}from"./chunk-XBOEW2LX.js";import{a as re}from"./chunk-B4LNCK4K.js";import{a as ae}from"./chunk-Y3IBO4VR.js";import{a as q,b as Q,c as Y,d as K,e as J,f as Z,g as X}from"./chunk-BRHEW7GJ.js";import{a as le}from"./chunk-ZV5EKPCH.js";import{b as ee,d as te,g as ne,s as ie}from"./chunk-PM2VUJQT.js";import"./chunk-2LUDLJ2U.js";import{$ as u,$a as f,Ga as y,La as O,Ob as R,Pa as _,Pb as U,Sb as D,Wa as m,Xa as o,Ya as i,Yb as H,Za as S,Zb as N,_ as p,_a as M,ab as d,cb as F,db as L,eb as V,fb as T,gb as P,hb as A,ib as s,jb as b,kb as h,mb as z,nb as G,ob as W,pb as $,qb as B,sb as k,ua as I,wa as l,wb as j}from"./chunk-OOT27GPI.js";var fe=["messagesContainer"],_e=()=>[];function Ce(a,g){if(a&1&&(o(0,"span",5),s(1),i()),a&2){let n=d(2);l(),b(n.pendingAlerts)}}function xe(a,g){if(a&1){let n=M();o(0,"button",3),f("click",function(){p(n);let e=d();return u(e.toggleChat())}),s(1," \u{1F916} "),_(2,Ce,2,1,"span",4),i()}if(a&2){let n=d();l(2),m("ngIf",n.pendingAlerts>0)}}function be(a,g){if(a&1&&(o(0,"small",29),S(1,"span",30),s(2),i()),a&2){let n=d(2);l(2),h(" ",n.isDiabetic?"\u{1FA7A} Diabetic Mode":"Agent Active"," ")}}function ve(a,g){if(a&1&&(o(0,"div",51)(1,"div",52)(2,"span",53),s(3),i(),o(4,"span",54),s(5,"Health"),i()()()),a&2){let n=d(3);l(),T("background",n.getScoreColor(n.healthScore)),l(2),b(n.healthScore)}}function Me(a,g){if(a&1&&(o(0,"div",35)(1,"span",36),s(2,"\u{1F35E}"),i(),o(3,"span",37),s(4),i(),o(5,"span",38),s(6,"Carbs"),i()()),a&2){let n=d(3);l(4),h("",n.displayTotalCarbs(),"g")}}function we(a,g){if(a&1&&(o(0,"div",35)(1,"span",36),s(2,"\u{1F525}"),i(),o(3,"span",37),s(4),i(),o(5,"span",38),s(6,"Calories"),i()()),a&2){let n=d(3);l(4),b(n.displayTotalCalories())}}function Se(a,g){if(a&1&&(o(0,"div",55)(1,"div",56)(2,"span"),s(3),i(),o(4,"span"),s(5),i()(),o(6,"div",57),S(7,"div",58),i()()),a&2){let n=d(3);l(3),h("Daily Carbs: ",n.totalCarbs,"g / 130g"),l(),P("warning",n.totalCarbs>100),l(),h("",n.getCarbsPercent(),"%"),l(2),T("width",n.getCarbsPercent(),"%"),P("warning",n.totalCarbs>100)("danger",n.totalCarbs>130)}}function Pe(a,g){if(a&1){let n=M();o(0,"div",61)(1,"span",62),s(2),i(),o(3,"div",63)(4,"strong"),s(5),i(),o(6,"p"),s(7),i()(),o(8,"button",64),f("click",function(){let e=p(n).$implicit,r=d(4);return u(r.dismissAlert(e))}),s(9,"\u2715"),i()()}if(a&2){let n=g.$implicit,t=d(4);A(n.type),l(2),b(t.getAlertIcon(n.type)),l(3),b(n.title),l(2),b(n.message)}}function ye(a,g){if(a&1&&(o(0,"div",59),_(1,Pe,10,5,"div",60),i()),a&2){let n=d(3);l(),m("ngForOf",n.alerts)}}function Oe(a,g){if(a&1){let n=M();o(0,"div",31)(1,"div",32),_(2,ve,6,3,"div",33),o(3,"div",34)(4,"div",35)(5,"span",36),s(6,"\u{1F37D}\uFE0F"),i(),o(7,"span",37),s(8),i(),o(9,"span",38),s(10,"Meals"),i()(),o(11,"div",35)(12,"span",36),s(13,"\u{1F4A7}"),i(),o(14,"span",37),s(15),i(),o(16,"span",38),s(17,"Water"),i()(),_(18,Me,7,1,"div",39)(19,we,7,1,"div",39),i()(),_(20,Se,8,10,"div",40)(21,ye,2,1,"div",41),o(22,"div",42)(23,"button",43),f("click",function(){p(n);let e=d(2);return u(e.quickAction("suggest-meal"))}),s(24),i(),o(25,"button",44),f("click",function(){p(n);let e=d(2);return u(e.quickAction("log-water"))}),s(26,"\u{1F4A7} +Water"),i(),o(27,"button",45),f("click",function(){p(n);let e=d(2);return u(e.addUserProvidedMenu())}),s(28,"\u2795 Import Menu"),i(),o(29,"button",46),f("click",function(){p(n);let e=d(2);return u(e.quickAction("analyze"))}),s(30,"\u{1F4CA} Analyze"),i(),o(31,"button",47),f("click",function(){p(n);let e=d(2);return u(e.analyzeProfileForGoals())}),s(32),i(),o(33,"button",48),f("click",function(){p(n);let e=d(2);return u(e.clearDashboard())}),s(34,"\u{1F5D1}\uFE0F Clear Dashboard"),i(),o(35,"button",49),f("click",function(){p(n);let e=d(2);return u(e.syncLocal())}),s(36,"\u{1F501} Sync Local"),i()(),o(37,"button",50),f("click",function(){p(n);let e=d(2);return u(e.showDashboard=!1)}),s(38,"Hide Dashboard \u25B2"),i()()}if(a&2){let n=d(2);l(2),m("ngIf",n.healthScore!==null),l(6),b(n.displayMealsCount()),l(7),h("",n.waterTotal,"ml"),l(3),m("ngIf",n.isDiabetic),l(),m("ngIf",!n.isDiabetic),l(),m("ngIf",n.isDiabetic),l(),m("ngIf",n.alerts.length>0),l(3),h(" \u{1F37D}\uFE0F ",n.isDiabetic?"Low-Carb Meals":"Suggest Meal"," "),l(7),m("disabled",n.isAnalyzingProfile),l(),h(" \u{1F3AF} ",n.isAnalyzingProfile?"Analysing...":"Objectifs"," ")}}function Ae(a,g){if(a&1){let n=M();o(0,"button",65),f("click",function(){p(n);let e=d(2);return u(e.showDashboard=!0)}),s(1," Show Dashboard \u25BC "),i()}}function ke(a,g){if(a&1&&(o(0,"div",73)(1,"span"),s(2,"\u{1F525} Calories:"),i(),o(3,"strong"),s(4),i()()),a&2){let n=d(3);l(4),b(n.currentGoals.calories)}}function De(a,g){if(a&1&&(o(0,"div",73)(1,"span"),s(2,"\u{1F4A7} Eau:"),i(),o(3,"strong"),s(4),i()()),a&2){let n=d(3);l(4),h("",n.currentGoals.water,"ml")}}function Ee(a,g){if(a&1&&(o(0,"div",73)(1,"span"),s(2,"\u{1F35E} Glucides:"),i(),o(3,"strong"),s(4),i()()),a&2){let n=d(3);l(4),h("",n.currentGoals.carbs,"g")}}function Ie(a,g){if(a&1){let n=M();o(0,"div",66)(1,"h4"),s(2,"\u{1F3AF} Objectifs Personnalis\xE9s Recommand\xE9s"),i(),o(3,"div",67),s(4),i(),o(5,"div",68)(6,"div",69)(7,"h5"),s(8,"Actuels"),i(),_(9,ke,5,1,"div",70)(10,De,5,1,"div",70)(11,Ee,5,1,"div",70),i(),o(12,"div",71),s(13,"\u2192"),i(),o(14,"div",72)(15,"h5"),s(16,"Sugg\xE9r\xE9s"),i(),o(17,"div",73)(18,"span"),s(19,"\u{1F525} Calories:"),i(),o(20,"strong"),s(21),i()(),o(22,"div",73)(23,"span"),s(24,"\u{1F4A7} Eau:"),i(),o(25,"strong"),s(26),i()(),o(27,"div",73)(28,"span"),s(29,"\u{1F35E} Glucides:"),i(),o(30,"strong"),s(31),i()()()(),o(32,"div",74)(33,"p"),s(34),i()(),o(35,"div",75)(36,"button",76),f("click",function(){p(n);let e=d(2);return u(e.acceptSuggestedGoals())}),s(37," \u2705 Accepter les changements "),i(),o(38,"button",77),f("click",function(){p(n);let e=d(2);return u(e.rejectSuggestedGoals())}),s(39," \u274C Garder mes objectifs actuels "),i()()()}if(a&2){let n=d(2);l(4),h("Confiance: ",n.goalsConfidence,"%"),l(5),m("ngIf",n.currentGoals),l(),m("ngIf",n.currentGoals),l(),m("ngIf",n.currentGoals),l(10),b(n.suggestedGoals.calories),l(5),h("",n.suggestedGoals.water,"ml"),l(5),h("",n.suggestedGoals.carbs,"g"),l(3),b(n.goalsExplanation)}}function Te(a,g){if(a&1){let n=M();o(0,"button",85),f("click",function(){let e=p(n).$implicit,r=d(3);return u(r.toggleCondition(e))}),s(1),i()}if(a&2){let n=g.$implicit,t=d(3);P("selected",t.selectedConditions.includes(n)),l(),h(" ",n," ")}}function Fe(a,g){if(a&1){let n=M();o(0,"button",85),f("click",function(){let e=p(n).$implicit,r=d(3);return u(r.toggleDiet(e))}),s(1),i()}if(a&2){let n=g.$implicit,t=d(3);P("selected",t.selectedDiets.includes(n)),l(),h(" ",n," ")}}function Le(a,g){if(a&1){let n=M();o(0,"button",85),f("click",function(){let e=p(n).$implicit,r=d(3);return u(r.toggleGoal(e))}),s(1),i()}if(a&2){let n=g.$implicit,t=d(3);P("selected",t.selectedGoals.includes(n)),l(),h(" ",n," ")}}function Ve(a,g){if(a&1){let n=M();o(0,"div",78)(1,"h4"),s(2,"\u{1F3AF} Personalize Your Experience"),i(),o(3,"p"),s(4,"Tell me about yourself for better recommendations:"),i(),o(5,"div",79)(6,"label"),s(7,"Health Conditions:"),i(),o(8,"div",80),_(9,Te,2,3,"button",81),i()(),o(10,"div",79)(11,"label"),s(12,"Dietary Preferences:"),i(),o(13,"div",80),_(14,Fe,2,3,"button",81),i()(),o(15,"div",79)(16,"label"),s(17,"Goals:"),i(),o(18,"div",80),_(19,Le,2,3,"button",81),i()(),o(20,"div",82)(21,"button",83),f("click",function(){p(n);let e=d(2);return u(e.saveProfile())}),s(22,"Save & Start Agent"),i(),o(23,"button",84),f("click",function(){p(n);let e=d(2);return u(e.skipProfile())}),s(24,"Skip for now"),i()()()}if(a&2){let n=d(2);l(9),m("ngForOf",n.healthConditionOptions),l(5),m("ngForOf",n.dietOptions),l(5),m("ngForOf",n.goalOptions)}}function ze(a,g){a&1&&(o(0,"span"),s(1,"\u2713"),i())}function Ge(a,g){a&1&&S(0,"span",94)}function We(a,g){if(a&1){let n=M();o(0,"button",91),f("click",function(){let e=p(n).$implicit,r=d(4);return u(r.executeAction(e))}),s(1),_(2,ze,2,0,"span",92)(3,Ge,1,0,"span",93),i()}if(a&2){let n=g.$implicit,t=d(4);A("action-btn "+n.status),m("disabled",n.status==="executing"),l(),h(" ",t.getActionLabel(n)," "),l(),m("ngIf",n.status==="completed"),l(),m("ngIf",n.status==="executing")}}function $e(a,g){if(a&1&&(o(0,"div",89),_(1,We,4,6,"button",90),i()),a&2){let n=d().$implicit;l(),m("ngForOf",n.actions)}}function Be(a,g){if(a&1&&(o(0,"div")(1,"div",86)(2,"strong"),s(3),i(),S(4,"div",87),_(5,$e,2,1,"div",88),i()()),a&2){let n=g.$implicit,t=d(2);A("message "+n.role),l(3),h("",n.role==="user"?"You":n.role==="system"?"\u26A1 Agent":"\u{1F916} AI",":"),l(),m("innerHTML",t.formatMessage(n.content),I),l(),m("ngIf",n.actions&&n.actions.length>0)}}function je(a,g){if(a&1&&(o(0,"li"),s(1),o(2,"small"),s(3),i()()),a&2){let n=g.$implicit;l(),z(" ",n.name," - ",n.portion||n.quantity||"N/A","",n.unit||""," "),l(2),h("(",n.calories,"kcal)")}}function Re(a,g){if(a&1){let n=M();o(0,"div",97)(1,"div",98)(2,"h5"),s(3),i(),o(4,"div",99)(5,"span",100),s(6),i(),o(7,"span",101),s(8),i()()(),o(9,"div",102)(10,"div",103)(11,"span",104),s(12,"Prot\xE9ines:"),i(),o(13,"span",105),s(14),i()(),o(15,"div",103)(16,"span",104),s(17,"Glucides:"),i(),o(18,"span",105),s(19),i()(),o(20,"div",103)(21,"span",104),s(22,"Lipides:"),i(),o(23,"span",105),s(24),i()(),o(25,"div",103)(26,"span",104),s(27,"Calories:"),i(),o(28,"span",105),s(29),i()()(),o(30,"div",106)(31,"h6"),s(32,"Aliments sugg\xE9r\xE9s:"),i(),o(33,"ul"),_(34,je,4,4,"li",107),i()(),o(35,"div",108)(36,"button",109),f("click",function(){let e=p(n).$implicit,r=d(3);return u(r.logMealFromSuggestion(e))}),s(37," \u{1F4DD} Enregistrer ce Repas "),i(),o(38,"button",110),f("click",function(){let e=p(n).$implicit,r=d(3);return u(r.navigateToMeals(e))}),s(39," \u2795 Ajouter aux Aliments "),i()()()}if(a&2){let n=g.$implicit;l(3),b(n.name),l(3),h("",n.totalCalories||n.calories||0," kcal"),l(2),b(n.prepTime||"25 minutes"),l(6),h("",n.totalProtein||n.protein||0,"g"),l(4),P("low-carb",(n.totalCarbs||n.carbs||0)<=15),l(),h("",n.totalCarbs||n.carbs||0,"g"),l(5),h("",n.totalFat||n.fats||0,"g"),l(5),b(n.totalCalories||n.calories||0),l(5),m("ngForOf",n.foods)}}function Ue(a,g){if(a&1&&(o(0,"div",95)(1,"h4"),s(2,"\u{1F37D}\uFE0F Recommandations de Repas"),i(),_(3,Re,40,10,"div",96),i()),a&2){let n=d(2);l(3),m("ngForOf",n.mealSuggestions)("ngForTrackBy",n.trackBySuggestion)}}function qe(a,g){if(a&1&&(o(0,"li"),s(1),i()),a&2){let n=g.$implicit;l(),G(" ",n.name," (",n.portion,") - ",n.calories," cal, ",n.carbs,"g carbs ")}}function He(a,g){if(a&1&&(o(0,"div",122),s(1),i()),a&2){let n=d(4);l(),h(" ",n.selectedMeal==null?null:n.selectedMeal.tips," ")}}function Ne(a,g){if(a&1){let n=M();o(0,"div",115)(1,"div",116)(2,"div",117)(3,"span",104),s(4,"Calories"),i(),o(5,"span",105),s(6),i()(),o(7,"div",117)(8,"span",104),s(9,"Carbs"),i(),o(10,"span",105),s(11),i()(),o(12,"div",117)(13,"span",104),s(14,"Protein"),i(),o(15,"span",105),s(16),i()(),o(17,"div",117)(18,"span",104),s(19,"Fat"),i(),o(20,"span",105),s(21),i()()(),o(22,"div",118)(23,"h5"),s(24,"\u{1F958} Ingredients:"),i(),o(25,"ul"),_(26,qe,2,4,"li",107),i()(),S(27,"div",119),_(28,He,2,1,"div",120),o(29,"div",121)(30,"button",109),f("click",function(){p(n);let e=d(3);return u(e.selectedMeal&&e.logMealFromSuggestion(e.selectedMeal))}),s(31," \u2705 Log This Meal "),i(),o(32,"button",110),f("click",function(){p(n);let e=d(3);return u(e.selectedMeal&&e.navigateToMeals(e.selectedMeal))}),s(33," \u2795 Add to Meal Plan "),i()()()}if(a&2){let n=d(3);l(6),b((n.selectedMeal==null?null:n.selectedMeal.totalCalories)||(n.selectedMeal==null?null:n.selectedMeal.calories)||0),l(4),P("highlight",n.isDiabetic),l(),h("",(n.selectedMeal==null?null:n.selectedMeal.totalCarbs)||(n.selectedMeal==null?null:n.selectedMeal.carbs)||0,"g"),l(5),h("",(n.selectedMeal==null?null:n.selectedMeal.totalProtein)||(n.selectedMeal==null?null:n.selectedMeal.protein)||0,"g"),l(5),h("",(n.selectedMeal==null?null:n.selectedMeal.totalFat)||(n.selectedMeal==null?null:n.selectedMeal.fat)||0,"g"),l(5),m("ngForOf",(n.selectedMeal==null?null:n.selectedMeal.foods)||k(9,_e)),l(),m("innerHTML",n.formatMessage((n.selectedMeal==null?null:n.selectedMeal.recipe)||(n.selectedMeal==null?null:n.selectedMeal.text)||""),I),l(),m("ngIf",n.selectedMeal==null?null:n.selectedMeal.tips)}}function Qe(a,g){if(a&1){let n=M();o(0,"div",111)(1,"div",112)(2,"h4"),s(3),i(),o(4,"button",113),f("click",function(){p(n);let e=d(2);return u(e.selectedMeal=null)}),s(5,"\u2715"),i()(),_(6,Ne,34,10,"div",114),i()}if(a&2){let n=d(2);l(3),b(n.selectedMeal==null?null:n.selectedMeal.name),l(3),m("ngIf",n.selectedMeal)}}function Ye(a,g){a&1&&(o(0,"div",123)(1,"div",86)(2,"div",124),S(3,"span")(4,"span")(5,"span"),i()()())}function Ke(a,g){a&1&&(o(0,"span",127),s(1,"\u{1F464}"),i())}function Je(a,g){if(a&1&&(o(0,"div",125)(1,"small"),s(2),i(),_(3,Ke,2,0,"span",126),i()),a&2){let n=d(2);l(2),h(" ",n.isDiabetic?"\u{1FA7A} Diabetic Mode | Carbs: "+n.displayTotalCarbs()+"g/130g":"\u{1F4CA} Monitoring "+n.displayMealsCount()+" meals"," "),l(),m("ngIf",n.userProfileSet)}}function Ze(a,g){if(a&1&&(o(0,"div",128)(1,"small"),s(2),i()()),a&2){let n=d(2);l(2),b(n.isDiabetic?'Try: "Low carb dinner" \u2022 "What can I eat?" \u2022 "Log my salad"':'Try: "I ate..." \u2022 "Add water" \u2022 "Suggest meal"')}}function Xe(a,g){if(a&1){let n=M();o(0,"div",6)(1,"div",7)(2,"div",8)(3,"h3"),s(4,"\u{1F916} Makla AI Assistant"),i(),_(5,be,3,1,"small",9),i(),o(6,"div",10)(7,"button",11),f("click",function(){p(n);let e=d();return u(e.toggleExpand())}),s(8),i(),o(9,"button",12),f("click",function(){p(n);let e=d();return u(e.toggleAgentMode())}),s(10),i(),o(11,"button",13),f("click",function(){p(n);let e=d();return u(e.toggleChat())}),s(12,"\u2715"),i()()(),_(13,Oe,39,10,"div",14)(14,Ae,2,0,"button",15)(15,Ie,40,8,"div",16)(16,Ve,25,3,"div",17),o(17,"div",18,0),_(19,Be,6,5,"div",19)(20,Ue,4,2,"div",20)(21,Qe,7,2,"div",21)(22,Ye,6,0,"div",22),i(),o(23,"div",23),_(24,Je,4,2,"div",24),o(25,"div",25)(26,"input",26),B("ngModelChange",function(e){p(n);let r=d();return $(r.currentMessage,e)||(r.currentMessage=e),u(e)}),f("keyup.enter",function(){p(n);let e=d();return u(e.sendMessage())}),i(),o(27,"button",27),f("click",function(){p(n);let e=d();return u(e.sendMessage())}),s(28),i()(),_(29,Ze,3,1,"div",28),i()()}if(a&2){let n=d();P("agent-mode",n.agentMode)("expanded",n.expandedView),l(5),m("ngIf",n.agentMode),l(3),h(" ",n.expandedView?"\u{1F5D7}":"\u2B1C"," "),l(),P("active",n.agentMode),l(),h(" ",n.agentMode?"\u{1F9E0} Agent":"\u{1F4AC} Basic"," "),l(3),m("ngIf",n.agentMode&&n.showDashboard),l(),m("ngIf",n.agentMode&&!n.showDashboard),l(),m("ngIf",n.showGoalsSuggestion&&n.suggestedGoals),l(),m("ngIf",n.showProfileSetup),l(3),m("ngForOf",n.messages),l(),m("ngIf",n.mealSuggestions.length>0),l(),m("ngIf",n.selectedMeal),l(),m("ngIf",n.isLoading),l(2),m("ngIf",n.agentMode),l(2),W("ngModel",n.currentMessage),m("placeholder",n.getPlaceholder())("disabled",n.isLoading),l(),m("disabled",!n.currentMessage.trim()||n.isLoading),l(),h(" ",n.isLoading?"\u23F3":"\u{1F4E4}"," "),l(),m("ngIf",n.agentMode)}}var ce=(()=>{let g=class g{constructor(t,e,r,c,v,C){this.aiService=t,this.goalsSyncService=e,this.mealService=r,this.waterService=c,this.foodService=v,this.router=C,this.isOpen=!1,this.expandedView=!1,this.messages=[],this.currentMessage="",this.isLoading=!1,this.agentMode=!1,this.showDashboard=!0,this.showProfileSetup=!1,this.userProfileSet=!1,this.isDiabetic=!1,this.mealsCount=0,this.waterTotal=0,this.totalCalories=0,this.totalCarbs=0,this.healthScore=null,this.getScoreColor=w=>w==null?"#9e9e9e":w>=80?"#4CAF50":w>=60?"#FFC107":"#f44336",this.alerts=[],this.pendingAlerts=0,this.userMeals=[],this.userWater=[],this.userFoods=[],this.mealSuggestions=[],this.selectedMeal=null,this.suggestedMealsCount=0,this.suggestedCalories=0,this.suggestedCarbs=0,this.healthConditionOptions=["Diabetic","Hypertension","Heart Disease","Allergies","None"],this.dietOptions=["Vegan","Vegetarian","Gluten-Free","Keto","Halal","None"],this.goalOptions=["Weight Loss","Weight Gain","Muscle Building","Maintain Health","Better Energy"],this.selectedConditions=[],this.selectedDiets=[],this.selectedGoals=[],this.subscriptions=[],this.isLoggingMeal=!1,this.showGoalsSuggestion=!1,this.suggestedGoals=null,this.currentGoals=null,this.goalsExplanation="",this.goalsConfidence=0,this.isAnalyzingProfile=!1}ngOnInit(){this.messages.push({role:"assistant",content:"\u{1F44B} Hello! I am your Makla AI Nutrition Agent."}),this.setupSubscriptions(),this.loadAllUserData();try{this.mealService.syncLocalMeals().subscribe({next:t=>{t&&t.length&&this.messages.push({role:"assistant",content:`\u2705 Synced ${t.length} locally saved meal(s) to server.`})},error:()=>{}})}catch{}}setupSubscriptions(){this.subscriptions.push(this.aiService.alerts$.subscribe(t=>{this.alerts=t||[],this.pendingAlerts=this.alerts.filter(e=>e.priority==="high").length})),this.subscriptions.push(this.goalsSyncService.goals$.subscribe(t=>{this.currentGoals=t})),this.subscriptions.push(this.aiService.dashboardUpdate.subscribe(t=>{try{if(!t||!t.type)return;switch(t.type){case"SHOW_MEAL_PREVIEW":Array.isArray(t.data)?this.mealSuggestions=t.data:t.data&&(this.mealSuggestions=[t.data]),this.selectedMeal=this.mealSuggestions&&this.mealSuggestions.length?this.mealSuggestions[0]:null,this.computeSuggestedTotals(),this.showDashboard=!0,this.agentMode=!0;break;case"ADD_MEAL":t.data&&t.data.name?this.messages.push({role:"assistant",content:`\u2705 AI recorded suggestion: ${t.data.name}. Use the UI to confirm logging.`}):this.messages.push({role:"assistant",content:"\u2705 AI provided a meal update."}),this.loadAllUserData();break;case"UPDATE_GOALS":t.data&&(this.currentGoals=t.data);break;default:break}}catch(e){console.warn("Error handling dashboard update",e)}})),this.subscriptions.push(this.mealService.meals$.subscribe(t=>{this.userMeals=t||[],this.mealsCount=this.userMeals.length,this.totalCalories=this.userMeals.reduce((e,r)=>e+(r.calories||r.totalCalories||0),0),this.totalCarbs=this.userMeals.reduce((e,r)=>e+(r.carbs||r.totalCarbs||0),0)})),this.subscriptions.push(this.waterService.waterIntakes$.subscribe(t=>{this.userWater=t||[],this.waterTotal=this.userWater.reduce((e,r)=>e+(r.amount||0),0)}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.monitoringInterval&&clearInterval(this.monitoringInterval)}toggleChat(){this.isOpen=!this.isOpen,this.isOpen&&(this.pendingAlerts=0,setTimeout(()=>this.scrollToBottom(),100))}toggleExpand(){this.expandedView=!this.expandedView}toggleAgentMode(){if(this.agentMode=!this.agentMode,this.agentMode){this.aiService.activateAgent();let t=this.aiService.getUserProfile&&this.aiService.getUserProfile()||{};t.healthConditions?.length?(this.userProfileSet=!0,this.isDiabetic=t.healthConditions?.includes("Diabetic")||!1,this.startAgentMode()):this.showProfileSetup=!0}else this.aiService.deactivateAgent&&this.aiService.deactivateAgent(),this.stopMonitoring(),this.mealSuggestions=[],this.selectedMeal=null}startMonitoring(){this.monitoringInterval=setInterval(()=>{this.agentMode&&this.checkHealthStatus()},300*1e3)}stopMonitoring(){this.monitoringInterval&&clearInterval(this.monitoringInterval)}loadAllUserData(){this.mealService.getAllMeals().subscribe(),this.waterService.getAllWaterIntakes().subscribe(),this.foodService.getAllFoods().subscribe({next:t=>{this.userFoods=t||[]},error:t=>console.warn(t)})}analyzeProfileForGoals(){this.isAnalyzingProfile||(this.isAnalyzingProfile=!0,this.messages.push({role:"assistant",content:"\u{1F575}\uFE0F Analyse du profil en cours..."}),this.scrollToBottom(),setTimeout(()=>{try{let t=this.goalsSyncService.calculateGoalsFromProfile?this.goalsSyncService.calculateGoalsFromProfile({healthConditions:this.selectedConditions,diet:this.selectedDiets[0],goals:this.selectedGoals[0],age:30,weight:70,height:175,gender:"MALE",activityLevel:"MODERATE"}):null;t&&(this.suggestedGoals=t),this.currentGoals=this.goalsSyncService.getCurrentGoals?this.goalsSyncService.getCurrentGoals():this.currentGoals,this.goalsConfidence=80,this.goalsExplanation="Suggested based on provided profile.",this.showGoalsSuggestion=!0}catch(t){console.warn("Goal analysis failed",t),this.messages.push({role:"assistant",content:"\u274C Impossible d'analyser votre profil pour le moment."})}finally{this.isAnalyzingProfile=!1,this.scrollToBottom()}},1e3))}acceptSuggestedGoals(){if(this.suggestedGoals)try{this.goalsSyncService.updateGoals&&this.goalsSyncService.updateGoals(this.suggestedGoals,"Accepted from AI chat"),this.showGoalsSuggestion=!1,this.messages.push({role:"assistant",content:"\u2705 Objectifs appliqu\xE9s."}),this.scrollToBottom()}catch(t){console.warn("Failed to accept goals",t),this.messages.push({role:"assistant",content:"\u274C Impossible d'appliquer les objectifs."}),this.scrollToBottom()}}rejectSuggestedGoals(){this.showGoalsSuggestion=!1,this.messages.push({role:"assistant",content:"\u{1F44C} Objectifs actuels conserv\xE9s."}),this.scrollToBottom()}handleNutrientDeficiency(t,e){let r=t.replace(/-/g," "),c=`\u26A0\uFE0F Possible ${r} imbalance detected. I can suggest foods and meals rich in ${r}.`;this.messages.push({role:"assistant",content:c,actions:[{type:"navigate",label:"Voir suggestions",data:{path:"/meals"},parameters:{path:"/meals"},status:"pending"}]}),this.scrollToBottom()}handleMealPrepRequest(t){this.messages.push({role:"assistant",content:"\u{1F9D1}\u200D\u{1F373} Voulez-vous des id\xE9es rapides de meal-prep ou un plan d\xE9taill\xE9 ?",actions:[{type:"navigate",label:"Ouvrir Meal Prep Planner",data:{path:"/meal-prep-planner"},parameters:{path:"/meal-prep-planner"},status:"pending"}]}),this.scrollToBottom()}checkHealthStatus(){this.aiService.checkHealthAlerts&&this.aiService.checkHealthAlerts({meals:this.userMeals.slice(-10),water:this.userWater.slice(-10),todayCalories:this.getTodayCalories(),todayWater:this.getTodayWater(),todayCarbs:this.totalCarbs}).subscribe()}getTodayCalories(){let t=new Date().toDateString();return this.userMeals.filter(e=>new Date(e.date).toDateString()===t).reduce((e,r)=>e+(r.calories||0),0)}getTodayWater(){let t=new Date().toDateString();return this.userWater.filter(e=>new Date(e.date).toDateString()===t).reduce((e,r)=>e+(r.amount||0),0)}getCarbsPercent(){let t=this.displayTotalCarbs();return Math.min(100,Math.round(t/130*100))}displayMealsCount(){return(this.mealsCount||0)+(this.suggestedMealsCount&&this.mealsCount===0?this.suggestedMealsCount:0)}displayTotalCalories(){return this.totalCalories||this.suggestedCalories||0}displayTotalCarbs(){return this.totalCarbs||this.suggestedCarbs||0}getPlaceholder(){return this.isDiabetic?"Ask about low-carb meals, log food...":this.agentMode?"Ask anything or give commands...":"Ask about nutrition..."}sendMessage(){if(!this.currentMessage.trim()||this.isLoading)return;let t=this.currentMessage.trim();this.messages.push({role:"user",content:t}),this.currentMessage="",this.isLoading=!0,this.scrollToBottom(),this.mealSuggestions=[],this.selectedMeal=null;let e=t.toLowerCase();if(this.detectFoodMention(e)){this.handleSmartMealLogging(t);return}if(this.detectWaterMention(e)){this.handleSmartWaterLogging(t);return}if(this.detectRecommendationRequest(e)){this.processAgentCommand(t);return}this.agentMode?this.processAgentCommand(t):this.aiService.smartChatWithPhi3(t,this.aiService.getUserProfile()).subscribe({next:r=>{this.messages.push(r.response),this.isLoading=!1,this.scrollToBottom(),r.actions&&r.actions.length>0&&r.response.content.includes("###")&&this.addMealSuggestionsFromText(r.response.content)},error:()=>{this.messages.push({role:"assistant",content:"Sorry, I encountered an error."}),this.isLoading=!1}})}detectRecommendationRequest(t){return["suggest","recommend","what should i eat","what to eat","give me a meal","meal plan","dinner","lunch","breakfast","low sugar","low carb","healthy option"].some(r=>t.includes(r))}detectFoodMention(t){return["ate","eaten","had","just had","just ate","eating","consumed","finished","for breakfast","for lunch","for dinner","for snack","log meal","add meal","record meal","i had a","i ate a","i had some","i ate some"].some(r=>t.includes(r))}detectWaterMention(t){return["water","drank","drink","hydrate","hydration","glass of","glasses of","ml","liter","litre","cup of water","cups of water","bottle"].some(r=>t.includes(r))}processAgentCommand(t){let e=t.toLowerCase(),r=e.match(/(?:add|log|record)\s+(\d+)\s*(?:cal|calories|kcal)/i);if(r){let C=parseInt(r[1],10);this.handleDirectCalorieLog(C);return}if(e.includes("iron")&&(e.includes("deficit")||e.includes("deficient")||e.includes("low")||e.includes("need"))){this.handleNutrientDeficiency("iron",t);return}if((e.includes("vitamin d")||e.includes("vitamin-d"))&&(e.includes("deficit")||e.includes("low"))){this.handleNutrientDeficiency("vitamin-d",t);return}if(e.includes("calcium")&&(e.includes("deficit")||e.includes("low")||e.includes("need"))){this.handleNutrientDeficiency("calcium",t);return}if(e.includes("protein")&&(e.includes("deficit")||e.includes("low")||e.includes("need"))){this.handleNutrientDeficiency("protein",t);return}if(e.includes("prep time")||e.includes("meal prep")){this.handleMealPrepRequest(t);return}if(["dinner","lunch","breakfast","eat","meal","suggest","recommend","what should","help me","give me","show me","find me","need","calories","calorie","sugar","carb","carbs","low sugar","low carb","healthy","nutritious","protein","diet","food"].some(C=>e.includes(C))){let C=e.includes("breakfast")?"breakfast":e.includes("lunch")?"lunch":"dinner",w=e.includes("low sugar")||e.includes("low carb");this.messages.push({role:"assistant",content:w?"\u{1F37D}\uFE0F **Parfait !** Je vais vous sugg\xE9rer des repas **faibles en sucre et glucides** avec toutes les informations nutritionnelles d\xE9taill\xE9es.":this.isDiabetic?`\u{1F37D}\uFE0F Je vais vous trouver des **options ${C} adapt\xE9es aux diab\xE9tiques** avec faibles glucides et recettes compl\xE8tes !`:`\u{1F37D}\uFE0F Laissez-moi vous sugg\xE9rer d'excellentes **options ${C}** pour vous !`}),this.getMealSuggestions(C);return}if(e.includes("ate")||e.includes("had")||e.includes("eaten")||e.includes("log")&&(e.includes("meal")||e.includes("food"))){this.handleSmartMealLogging(t);return}if(e.includes("water")||e.includes("drink")||e.includes("hydrat")||e.includes("glass")||e.includes("ml")){this.handleSmartWaterLogging(t);return}if(e.includes("analysis")||e.includes("how am i")||e.includes("health")){this.runAgentAnalysis();return}this.aiService.smartChatWithPhi3(t,this.aiService.getUserProfile()).subscribe({next:C=>{let w=C.response,E=C.actions;if(this.messages.push(w),this.isLoading=!1,this.scrollToBottom(),C.actionData){let x=C.actionData;(x.calories||x.waterAmount||x.glasses)&&this.aiService.dashboardUpdate.emit({type:"SHOW_MEAL_PREVIEW",data:{name:x.mealName||t,calories:x.calories||0,carbs:x.carbs||0,protein:x.protein||0,fats:x.fats||0,water:x.waterAmount||x.glasses*250||0}})}this.agentMode&&E&&E.length>0&&(this.messages.push({role:"system",content:"\u26A1 Agent: Automatic action in progress..."}),E.forEach(x=>{if(x.type==="ADD_MEAL"&&x.parameters)this.handleSmartMealLogging(x.parameters.name||t,x.parameters);else if(x.type==="ADD_WATER"&&x.parameters){let pe=x.parameters.amount||x.parameters.glasses*250||250;this.handleSmartWaterLogging(`Log ${pe}ml`)}else this.executeAction(x)})),(w.content.includes("###")||w.content.includes("Suggest"))&&this.addMealSuggestionsFromText(w.content)},error:()=>{this.messages.push({role:"assistant",content:"Sorry, I encountered an error with the smart agent."}),this.isLoading=!1}})}scrollToBottom(){try{setTimeout(()=>{this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight},100)}catch{}}handleDirectCalorieLog(t){let e={name:`Quick Add (${t} kcal)`,mealTime:this.determineMealTime(),foods:[{name:"Quick Calories",portion:"1 serving",calories:t}],calories:t,protein:0,carbs:0,fats:0,recipe:"Quick added calories manually.",tips:"",date:new Date().toISOString(),uniqueId:`quick-cal-${Date.now()}`,aiGenerated:!1};this.isLoggingMeal=!0,this.isLoading=!0,this.saveMealAndUpdateStats(e)}handleSmartWaterLogging(t){let e=t.match(/(\d+)\s*(?:ml|l|glass|cup)/i),r=250;if(e){let c=parseInt(e[1],10);t.toLowerCase().includes("l")&&!t.toLowerCase().includes("ml")&&(c*=1e3),r=c}this.waterService.addWaterIntake({amount:r,date:new Date().toISOString()}).subscribe({next:()=>{this.messages.push({role:"assistant",content:`\u{1F4A7} Added **${r}ml** of water.
Your dashboard has been updated!`}),this.isLoading=!1,this.loadAllUserData(),this.scrollToBottom()},error:()=>{this.messages.push({role:"assistant",content:"\u274C Failed to log water."}),this.isLoading=!1,this.scrollToBottom()}})}extractFoodDescription(t){return t.replace(/^(I |he |she |we )?(ate|had|consumed|logged|log) /i,"").trim()}determineMealTime(){let t=new Date().getHours();return t<11?"Breakfast":t<16?"Lunch":"Dinner"}getCompleteNutritionEstimate(t){return{calories:300,protein:15,carbs:30,fat:10,fiber:5}}saveLocalMeal(t){let e=JSON.parse(localStorage.getItem("local_meals")||"[]");e.push(t),localStorage.setItem("local_meals",JSON.stringify(e))}runQuickAnalysis(){this.runAgentAnalysis()}runAgentAnalysis(){this.isLoading=!0,this.messages.push({role:"assistant",content:"\u{1F4CA} Running complete health analysis..."}),this.scrollToBottom();let t=this.userWater.reduce((r,c)=>r+(c.amount||0),0),e=JSON.stringify({calories:this.totalCalories,carbs:this.totalCarbs,protein:this.userMeals.reduce((r,c)=>r+(c.totalProtein||c.protein||0),0),water:t,meals:this.userMeals.length});this.aiService.quickAnalyzeWithPhi3(e,this.isDiabetic).subscribe({next:r=>{let c=`### \u{1FA7A} Health Analysis

**Health Score:** ${r.healthScore}/100

**\u26A0\uFE0F Insight:** ${r.topAlert}

**\u{1F4A1} Quick Tip:** ${r.quickTip}`;r.recommendations&&r.recommendations.length&&(c+=`

**Recommendations:**
`+r.recommendations.map(v=>`\u2022 ${v}`).join(`
`)),r.waterDeficit>0&&(c+=`

\u{1F4A7} **Hydration Alert:** You are ${r.waterDeficit}ml short of your goal.`),this.messages.push({role:"assistant",content:c}),this.isLoading=!1,this.scrollToBottom()},error:r=>{console.error("Agent analysis failed",r),this.messages.push({role:"assistant",content:"\u274C Analysis temporarily unavailable."}),this.isLoading=!1,this.scrollToBottom()}})}startAgentMode(){this.showProfileSetup=!1,this.startMonitoring(),this.runAgentAnalysis(),this.isDiabetic&&setTimeout(()=>this.getMealSuggestions("dinner"),800);try{let t={calories:this.totalCalories||0,carbs:this.totalCarbs||0,protein:this.userMeals?.reduce((r,c)=>r+(c.totalProtein||c.protein||0),0)||0,water:this.waterTotal||0,meals:this.mealsCount||0},e=this.aiService.autoAct(t,this.isDiabetic).subscribe({next:r=>{r&&this.processAutoActions(r)},error:r=>{console.warn("autoAct failed",r)}});this.subscriptions.push(e)}catch(t){console.warn("autoAct call failed",t)}}processAutoActions(t){try{if(t.water){let e=t.water,r=e.amount_ml||e.amount||250,c=e.message||`Time to hydrate \u2014 suggested ${r}ml.`;this.messages.push({role:"assistant",content:`\u{1F4A7} ${c}`}),this.updateAnalyticsAfterAutoAction({type:"water",amount:r})}if(t.carbs){let e=t.carbs,r=Array.isArray(e.suggestions)?e.suggestions:e.meals||[];r.length?(this.mealSuggestions=r.map(c=>({name:c.name||c.title||"Suggestion",foods:c.foods||c.ingredients||[],totalCalories:c.totalCalories||c.calories||0,totalCarbs:c.totalCarbs||c.carbs||0,totalProtein:c.totalProtein||c.protein||0,totalFat:c.totalFat||c.fats||0,recipe:c.recipe||c.instructions||"",tips:c.tips||c.notes||""})),this.mealSuggestions.length&&(this.selectedMeal=this.mealSuggestions[0],this.messages.push({role:"assistant",content:`\u{1F37D}\uFE0F I suggested ${this.mealSuggestions.length} low-carb options for you. Click one to log it.`}),this.computeSuggestedTotals())):e.message&&this.messages.push({role:"assistant",content:`\u{1F37D}\uFE0F ${e.message}`})}if(t.protein){let e=t.protein;this.messages.push({role:"assistant",content:`\u{1F357} ${e.message||"Consider a protein-rich snack."}`})}t.success,this.scrollToBottom()}catch(e){console.warn("processAutoActions error",e)}}updateAnalyticsAfterAutoAction(t){if(t&&(t.type==="water"||t.amount)){let e=t.amount||t.amount_ml||0;e>0&&(this.aiService.updateDashboard("ADD_WATER",{amount:e,date:new Date().toISOString()}),this.userWater=this.userWater||[],this.userWater.push({amount:e,date:new Date().toISOString(),aiGenerated:!0}),this.waterTotal=(this.waterTotal||0)+e,this.messages.push({role:"assistant",content:`\u2705 Logged ${e}ml water (auto-action).`}))}}extractFoodsWithQuantities(t){if(!t)return[];let e=[],r=t.split(/[,;]|\band\b|\bwith\b/i).map(c=>c.trim()).filter(Boolean);for(let c of r){let v=c.match(/(\d+\s*(?:g|grams|kg|ml|l|cup|cups|glass|slice|slices|tbsp|tsp|tablespoon|teaspoon))\s+(.+)/i);if(v){e.push({name:v[2].trim(),qty:v[1].trim()});continue}let C=c.match(/^\s*(\d+)\s+(.+)$/);if(C){e.push({name:C[2].trim(),qty:C[1].trim()});continue}e.push({name:c})}return e}getAlertIcon(t){switch((t||"").toLowerCase()){case"danger":return"\u{1F6A8}";case"warning":return"\u26A0\uFE0F";case"info":return"\u2139\uFE0F";default:return"\u{1F514}"}}dismissAlert(t){this.alerts=this.alerts.filter(e=>e!==t)}quickAction(t){switch(t){case"suggest-meal":this.currentMessage="Suggest a healthy meal",this.sendMessage();break;case"log-water":this.currentMessage="Log 250ml water",this.sendMessage();break;case"analyze":this.runAgentAnalysis();break;default:console.warn("Unknown quick action",t)}}addUserProvidedMenu(){this.messages.push({role:"assistant",content:"\u{1F5C2}\uFE0F Feature not implemented: import menu. You can paste a menu and I will analyze it."}),this.scrollToBottom()}clearDashboard(){}syncLocal(){}toggleCondition(t){let e=this.selectedConditions.indexOf(t);e>=0?this.selectedConditions.splice(e,1):this.selectedConditions.push(t)}toggleDiet(t){let e=this.selectedDiets.indexOf(t);e>=0?this.selectedDiets.splice(e,1):this.selectedDiets.push(t)}toggleGoal(t){let e=this.selectedGoals.indexOf(t);e>=0?this.selectedGoals.splice(e,1):this.selectedGoals=[t]}saveProfile(){this.aiService.updateUserProfile&&this.aiService.updateUserProfile({healthConditions:this.selectedConditions,dietaryRestrictions:this.selectedDiets,goals:this.selectedGoals}),this.userProfileSet=!0,this.showProfileSetup=!1,this.startAgentMode()}skipProfile(){this.showProfileSetup=!1,this.userProfileSet=!1,this.startAgentMode()}formatMessage(t){return t?(t+"").replace(/\n/g,"<br/>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"):""}executeAction(t){if(t){t.status="executing";try{if(t.type==="ADD_WATER"){let e=t.parameters?.amount||250;this.waterService.addWaterIntake({amount:e,date:new Date().toISOString()}).subscribe({next:()=>{t.status="completed",this.aiService.dashboardUpdate.emit({type:"ADD_WATER",data:{amount:e,date:new Date().toISOString()}}),this.loadAllUserData()},error:()=>{t.status="failed"}})}else if(t.type==="ADD_MEAL"){let e=t.parameters||{name:"AI Meal",calories:300};this.saveMealAndUpdateStats({name:e.name||"AI Meal",calories:e.calories||300,carbs:e.carbs||0,protein:e.protein||0,fats:e.fats||0,foods:e.foods||[],date:new Date().toISOString()}),t.status="completed"}else t.type==="GET_SUGGESTIONS"?(this.getMealSuggestions(t.parameters?.mealType||"dinner"),t.status="completed"):(console.warn("Unhandled action executeAction:",t.type),t.status="failed")}catch{t.status="failed"}}}getActionLabel(t){return t?.label||t?.type||"ACTION"}trackBySuggestion(t,e){return e?.name||t}logMealFromSuggestion(t){if(!t)return;let e={name:t.name||"Suggested Meal",calories:t.totalCalories||t.calories||300,carbs:t.totalCarbs||t.carbs||0,protein:t.totalProtein||t.protein||0,fats:t.totalFat||t.fats||0,foods:t.foods||[],date:new Date().toISOString()};this.saveMealAndUpdateStats(e)}navigateToMeals(t){this.aiService.updateDashboard("SHOW_MEAL_PREVIEW",t||{});try{this.router.navigate(["/meals"])}catch{}}handleSmartMealLogging(t,e){let r=e?.name||this.extractFoodDescription(t)||t,c=this.extractFoodsWithQuantities(r),v=this.getCompleteNutritionEstimate(r),C={name:e?.name||r,calories:e?.calories||v.calories||300,carbs:e?.carbs||v.carbs||30,protein:e?.protein||v.protein||15,fats:e?.fats||v.fat||10,foods:c.length?c.map(w=>({name:w.name,portion:w.qty||"1 serving"})):[{name:r,portion:"1 serving"}],date:new Date().toISOString()};this.messages.push({role:"assistant",content:`\u{1F37D}\uFE0F Logging your meal: ${C.name} \u2014 estimated ${C.calories} kcal`}),this.saveMealAndUpdateStats(C)}addMealSuggestionsFromText(t){if(!t)return;let e=t.split(/\r?\n/).map(c=>c.trim()).filter(Boolean),r=[];for(let c of e)if(/^-\s*/.test(c)||/\d+\s*kcal/i.test(c)||/calories/i.test(c)){let v=c.replace(/^-\s*/,"").replace(/\(.*?\)/,"").trim();r.push({name:v,totalCalories:c.match(/(\d+)\s*kcal/i)?.[1]?parseInt(c.match(/(\d+)\s*kcal/i)[1],10):300,foods:[]})}r.length&&(this.mealSuggestions=r,this.selectedMeal=r[0],this.computeSuggestedTotals())}getMealSuggestions(t){try{this.aiService.generateDiabeticMealPlan(t).subscribe({next:e=>{if(e&&e.length){this.mealSuggestions=e,this.selectedMeal=e[0],this.computeSuggestedTotals(),this.messages.push({role:"assistant",content:`\u{1F37D}\uFE0F I found ${e.length} suggested ${t} options.`}),this.scrollToBottom();try{this.aiService.updateDashboard("SHOW_MEAL_PREVIEW",e)}catch{}}},error:e=>{console.warn("getMealSuggestions failed",e)}})}catch(e){console.warn("getMealSuggestions error",e)}}computeSuggestedTotals(){if(!this.mealSuggestions||!this.mealSuggestions.length){this.suggestedMealsCount=0,this.suggestedCalories=0,this.suggestedCarbs=0;return}this.suggestedMealsCount=this.mealSuggestions.length,this.suggestedCalories=this.mealSuggestions.reduce((t,e)=>t+(e.totalCalories||e.calories||0),0),this.suggestedCarbs=this.mealSuggestions.reduce((t,e)=>t+(e.totalCarbs||e.carbs||0),0)}saveMealAndUpdateStats(t){try{this.mealService&&typeof this.mealService.createMeal=="function"?this.mealService.createMeal(t).subscribe({next:e=>{this.messages.push({role:"assistant",content:"\u2705 Meal saved."}),this.loadAllUserData(),this.scrollToBottom()},error:e=>{console.warn("createMeal failed",e),this.saveLocalMeal(t),this.loadAllUserData(),this.messages.push({role:"assistant",content:"\u26A0\uFE0F Meal saved locally (offline)."}),this.scrollToBottom()}}):(this.saveLocalMeal(t),this.messages.push({role:"assistant",content:"\u2705 Meal saved locally."}),this.loadAllUserData(),this.scrollToBottom())}catch(e){console.warn("saveMealAndUpdateStats error",e),this.saveLocalMeal(t),this.messages.push({role:"assistant",content:"\u26A0\uFE0F Meal saved locally (error path)."}),this.loadAllUserData(),this.scrollToBottom()}}};g.\u0275fac=function(e){return new(e||g)(y(oe),y(ae),y(se),y(re),y(le),y(Y))},g.\u0275cmp=O({type:g,selectors:[["app-ai-chat"]],viewQuery:function(e,r){if(e&1&&F(fe,5),e&2){let c;L(c=V())&&(r.messagesContainer=c.first)}},decls:2,vars:2,consts:[["messagesContainer",""],["class","chat-button","title","AI Nutrition Agent",3,"click",4,"ngIf"],["class","chat-window",3,"agent-mode","expanded",4,"ngIf"],["title","AI Nutrition Agent",1,"chat-button",3,"click"],["class","alert-badge",4,"ngIf"],[1,"alert-badge"],[1,"chat-window"],[1,"chat-header"],[1,"header-info"],["class","agent-status",4,"ngIf"],[1,"header-actions"],["title","Expand",1,"expand-btn",3,"click"],["title","Toggle Agent Mode",1,"mode-toggle",3,"click"],[1,"minimize-btn",3,"click"],["class","agent-dashboard",4,"ngIf"],["class","toggle-dashboard show",3,"click",4,"ngIf"],["class","goals-suggestion-panel",4,"ngIf"],["class","profile-setup",4,"ngIf"],[1,"chat-messages"],[3,"class",4,"ngFor","ngForOf"],["class","meal-suggestions",4,"ngIf"],["class","meal-detail-panel",4,"ngIf"],["class","message assistant",4,"ngIf"],[1,"chat-input-area"],["class","context-bar",4,"ngIf"],[1,"input-row"],[1,"chat-input",3,"ngModelChange","keyup.enter","ngModel","placeholder","disabled"],[1,"send-btn",3,"click","disabled"],["class","command-hints",4,"ngIf"],[1,"agent-status"],[1,"pulse"],[1,"agent-dashboard"],[1,"dashboard-row"],["class","health-score",4,"ngIf"],[1,"quick-stats"],[1,"stat-item"],[1,"stat-icon"],[1,"stat-value"],[1,"stat-label"],["class","stat-item",4,"ngIf"],["class","carb-progress",4,"ngIf"],["class","alerts-panel",4,"ngIf"],[1,"quick-actions"],["title","Get diabetic-friendly meals",3,"click"],["title","Quick add water",3,"click"],["title","Importer le menu utilisateur",3,"click"],["title","Full analysis",3,"click"],["title","AI analyze profile for personalized goals",3,"click","disabled"],["title","Clear all dashboard data",3,"click"],["title","Sync locally saved meals to backend",3,"click"],[1,"toggle-dashboard",3,"click"],[1,"health-score"],[1,"score-circle"],[1,"score-value"],[1,"score-label"],[1,"carb-progress"],[1,"progress-label"],[1,"progress-bar"],[1,"progress-fill"],[1,"alerts-panel"],["class","alert-item",3,"class",4,"ngFor","ngForOf"],[1,"alert-item"],[1,"alert-icon"],[1,"alert-content"],[1,"alert-dismiss",3,"click"],[1,"toggle-dashboard","show",3,"click"],[1,"goals-suggestion-panel"],[1,"confidence-badge"],[1,"goals-comparison"],[1,"goals-column"],["class","goal-item",4,"ngIf"],[1,"arrow"],[1,"goals-column","suggested"],[1,"goal-item"],[1,"goals-explanation"],[1,"goals-actions"],[1,"accept-btn",3,"click"],[1,"reject-btn",3,"click"],[1,"profile-setup"],[1,"profile-field"],[1,"chip-select"],[3,"selected","click",4,"ngFor","ngForOf"],[1,"profile-actions"],[1,"save-profile",3,"click"],[1,"skip-profile",3,"click"],[3,"click"],[1,"message-content"],[3,"innerHTML"],["class","message-actions",4,"ngIf"],[1,"message-actions"],[3,"disabled","class","click",4,"ngFor","ngForOf"],[3,"click","disabled"],[4,"ngIf"],["class","spinner",4,"ngIf"],[1,"spinner"],[1,"meal-suggestions"],["class","suggestion-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"suggestion-card"],[1,"suggestion-header"],[1,"meal-stats"],[1,"calories"],[1,"time"],[1,"nutrition-preview"],[1,"nutrient"],[1,"label"],[1,"value"],[1,"foods-list"],[4,"ngFor","ngForOf"],[1,"suggestion-actions"],[1,"btn-log-meal",3,"click"],[1,"btn-add-foods",3,"click"],[1,"meal-detail-panel"],[1,"meal-detail-header"],[1,"close-detail",3,"click"],["class","meal-detail-content",4,"ngIf"],[1,"meal-detail-content"],[1,"nutrition-summary"],[1,"nutrition-item"],[1,"ingredients-list"],[1,"recipe-content",3,"innerHTML"],["class","meal-tips",4,"ngIf"],[1,"meal-actions"],[1,"meal-tips"],[1,"message","assistant"],[1,"typing-indicator"],[1,"context-bar"],["class","profile-badge","title","Profile active",4,"ngIf"],["title","Profile active",1,"profile-badge"],[1,"command-hints"]],template:function(e,r){e&1&&_(0,xe,3,1,"button",1)(1,Xe,30,24,"div",2),e&2&&(m("ngIf",!r.isOpen),l(),m("ngIf",r.isOpen))},dependencies:[D,R,U,ie,ee,te,ne],styles:['.chat-button[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;font-size:28px;cursor:pointer;box-shadow:0 4px 15px #667eea80;transition:transform .3s,box-shadow .3s;z-index:1000}.chat-button[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.alert-badge[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;background:#f44;color:#fff;border-radius:50%;width:22px;height:22px;font-size:12px;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_pulse-badge 2s infinite}.chat-window[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;width:420px;height:650px;background:#fff;border-radius:15px;box-shadow:0 8px 30px #00000040;display:flex;flex-direction:column;z-index:1000;animation:_ngcontent-%COMP%_slideUp .3s ease-out;transition:all .3s ease}.chat-window.expanded[_ngcontent-%COMP%]{width:600px;height:80vh;max-height:800px}.chat-window.agent-mode[_ngcontent-%COMP%]{border:2px solid #4CAF50}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.chat-header[_ngcontent-%COMP%]{padding:1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:13px 13px 0 0;display:flex;justify-content:space-between;align-items:center}.agent-mode[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4caf50,#2e7d32)}.header-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.agent-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;font-size:.75rem}.pulse[_ngcontent-%COMP%]{width:8px;height:8px;background:#81c784;border-radius:50%;animation:_ngcontent-%COMP%_pulse-dot 1.5s infinite}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.expand-btn[_ngcontent-%COMP%], .mode-toggle[_ngcontent-%COMP%], .minimize-btn[_ngcontent-%COMP%]{padding:.4rem .6rem;background:#fff3;border:1px solid rgba(255,255,255,.3);color:#fff;border-radius:5px;cursor:pointer;font-size:.8rem}.mode-toggle.active[_ngcontent-%COMP%]{background:#ffffff4d}.agent-dashboard[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#f8f9fa,#fff);padding:.8rem;border-bottom:1px solid #e0e0e0}.dashboard-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:.5rem}.health-score[_ngcontent-%COMP%]   .score-circle[_ngcontent-%COMP%]{width:55px;height:55px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;box-shadow:0 3px 10px #00000026}.score-value[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700}.score-label[_ngcontent-%COMP%]{font-size:.6rem}.quick-stats[_ngcontent-%COMP%]{display:flex;flex:1;justify-content:space-around}.stat-item[_ngcontent-%COMP%]{text-align:center}.stat-icon[_ngcontent-%COMP%]{font-size:1rem;display:block}.stat-value[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem;color:#333}.stat-label[_ngcontent-%COMP%]{font-size:.65rem;color:#666}.carb-progress[_ngcontent-%COMP%]{margin:.5rem 0;padding:.5rem;background:#fff3e0;border-radius:8px;border-left:3px solid #ff9800}.progress-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.75rem;margin-bottom:.3rem}.progress-label[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{color:#f44336;font-weight:700}.progress-bar[_ngcontent-%COMP%]{height:8px;background:#e0e0e0;border-radius:4px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#4caf50;transition:width .3s}.progress-fill.warning[_ngcontent-%COMP%]{background:#ff9800}.progress-fill.danger[_ngcontent-%COMP%]{background:#f44336}.alerts-panel[_ngcontent-%COMP%]{max-height:80px;overflow-y:auto;margin:.5rem 0}.alert-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.4rem;border-radius:6px;margin-bottom:.3rem;font-size:.8rem}.alert-item.warning[_ngcontent-%COMP%]{background:#fff3cd;border-left:3px solid #ffc107}.alert-item.info[_ngcontent-%COMP%]{background:#d1ecf1;border-left:3px solid #17a2b8}.alert-item.error[_ngcontent-%COMP%]{background:#f8d7da;border-left:3px solid #dc3545}.quick-actions[_ngcontent-%COMP%]{display:flex;gap:.3rem;flex-wrap:wrap}.quick-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:80px;padding:.4rem;background:#f5f5f5;border:1px solid #ddd;border-radius:6px;cursor:pointer;font-size:.7rem;transition:all .2s}.quick-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#4caf50;color:#fff;border-color:#4caf50}.toggle-dashboard[_ngcontent-%COMP%]{width:100%;padding:.5rem;background:#f8f9fa;border:none;border-top:1px solid #e0e0e0;cursor:pointer;font-size:.75rem;color:#777;font-weight:600;text-transform:uppercase;letter-spacing:.5px;transition:all .2s;border-radius:0 0 5px 5px}.toggle-dashboard[_ngcontent-%COMP%]:hover{background:#e9ecef;color:#333}.toggle-dashboard.show[_ngcontent-%COMP%]{border-top:none;border-bottom:1px solid #e0e0e0;background:#fff;color:#4caf50;margin-bottom:.5rem;border-radius:5px;box-shadow:0 2px 5px #0000000d}.goals-suggestion-panel[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e8f5e9,#f1f8e9);border:2px solid #4CAF50;border-radius:12px;padding:1rem;margin:.5rem;box-shadow:0 4px 12px #4caf5033}.goals-suggestion-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#2e7d32;font-size:1rem;display:flex;align-items:center;gap:.5rem}.confidence-badge[_ngcontent-%COMP%]{display:inline-block;background:#4caf50;color:#fff;padding:.2rem .6rem;border-radius:12px;font-size:.7rem;font-weight:700;margin-bottom:.8rem}.goals-comparison[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0;padding:.8rem;background:#fff;border-radius:8px}.goals-column[_ngcontent-%COMP%]{flex:1}.goals-column[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.8rem;color:#666;text-transform:uppercase}.goals-column.suggested[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#4caf50}.goal-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.3rem 0;font-size:.85rem}.goal-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#666}.goal-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333;font-weight:700}.arrow[_ngcontent-%COMP%]{font-size:1.5rem;color:#4caf50;font-weight:700}.goals-explanation[_ngcontent-%COMP%]{background:#fff;padding:.8rem;border-radius:8px;margin:.8rem 0;border-left:3px solid #4CAF50}.goals-explanation[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.85rem;line-height:1.4;color:#333}.goals-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem}.accept-btn[_ngcontent-%COMP%], .reject-btn[_ngcontent-%COMP%]{flex:1;padding:.6rem;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:.85rem;transition:all .2s}.accept-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4caf50,#66bb6a);color:#fff}.accept-btn[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #4caf5066;transform:translateY(-2px)}.reject-btn[_ngcontent-%COMP%]{background:#f5f5f5;color:#666;border:1px solid #ddd}.reject-btn[_ngcontent-%COMP%]:hover{background:#e0e0e0}.profile-setup[_ngcontent-%COMP%]{padding:1rem;background:#f8f9fa;max-height:220px;overflow-y:auto}.profile-setup[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem}.profile-setup[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .8rem;font-size:.8rem;color:#666}.profile-field[_ngcontent-%COMP%]{margin-bottom:.6rem}.profile-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.75rem;font-weight:600;margin-bottom:.2rem}.chip-select[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.25rem}.chip-select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.25rem .5rem;background:#fff;border:1px solid #ddd;border-radius:12px;cursor:pointer;font-size:.7rem}.chip-select[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background:#4caf50;color:#fff;border-color:#4caf50}.profile-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.8rem}.save-profile[_ngcontent-%COMP%]{flex:1;padding:.5rem;background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600}.skip-profile[_ngcontent-%COMP%]{padding:.5rem;background:#f0f0f0;border:none;border-radius:6px;cursor:pointer}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem;background:#f5f5f5}.message[_ngcontent-%COMP%]{margin-bottom:.8rem}.message.user[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;margin-left:auto;max-width:80%}.message.assistant[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#fff;color:#333;max-width:85%}.message.system[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4caf50,#81c784);color:#fff;max-width:90%;border-left:3px solid #2E7D32}.message-content[_ngcontent-%COMP%]{padding:.7rem;border-radius:10px;box-shadow:0 2px 4px #0000001a}.message-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-size:.75rem;margin-bottom:.2rem;opacity:.9}.meal-suggestions-panel[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1rem;margin:.5rem 0;box-shadow:0 2px 8px #0000001a}.meal-suggestions-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .8rem;color:#2e7d32;font-size:1rem}.meal-cards[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.8rem}.meal-card[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #e0e0e0;border-radius:10px;padding:.8rem;cursor:pointer;transition:all .2s}.meal-card[_ngcontent-%COMP%]:hover{border-color:#4caf50;box-shadow:0 2px 8px #4caf5033}.meal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.meal-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:#333}.meal-time[_ngcontent-%COMP%]{font-size:.7rem;color:#666}.meal-macros[_ngcontent-%COMP%]{display:flex;gap:.8rem;margin-bottom:.5rem}.macro[_ngcontent-%COMP%]{font-size:.75rem;padding:.2rem .4rem;background:#e8e8e8;border-radius:4px}.macro.carbs.low[_ngcontent-%COMP%]{background:#c8e6c9;color:#2e7d32}.meal-badges[_ngcontent-%COMP%]{display:flex;gap:.4rem;margin-bottom:.5rem}.badge[_ngcontent-%COMP%]{font-size:.65rem;padding:.15rem .4rem;border-radius:10px}.badge.diabetic[_ngcontent-%COMP%]{background:#c8e6c9;color:#1b5e20}.badge.gi-low[_ngcontent-%COMP%]{background:#bbdefb;color:#1565c0}.view-recipe-btn[_ngcontent-%COMP%]{width:100%;padding:.5rem;background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:.8rem}.meal-detail-panel[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1rem;margin:.5rem 0;box-shadow:0 4px 12px #00000026;border:2px solid #4CAF50}.meal-detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid #e0e0e0}.meal-detail-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#2e7d32}.close-detail[_ngcontent-%COMP%]{background:none;border:none;font-size:1.2rem;cursor:pointer;color:#666}.nutrition-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-around;background:#f5f5f5;padding:.8rem;border-radius:8px;margin-bottom:1rem}.nutrition-item[_ngcontent-%COMP%]{text-align:center}.nutrition-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:.7rem;color:#666}.nutrition-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:#333}.nutrition-item[_ngcontent-%COMP%]   .value.highlight[_ngcontent-%COMP%]{color:#4caf50}.ingredients-list[_ngcontent-%COMP%]{margin-bottom:1rem}.ingredients-list[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.85rem}.ingredients-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1.2rem;font-size:.8rem}.ingredients-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.3rem}.recipe-content[_ngcontent-%COMP%]{background:#f8f9fa;padding:1rem;border-radius:8px;font-size:.85rem;line-height:1.5;margin-bottom:1rem}.meal-tips[_ngcontent-%COMP%]{background:#fff3e0;padding:.8rem;border-radius:8px;font-size:.8rem;border-left:3px solid #ff9800;margin-bottom:1rem}.meal-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.typing-indicator[_ngcontent-%COMP%]{display:flex;gap:4px}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:8px;height:8px;background:#667eea;border-radius:50%;animation:_ngcontent-%COMP%_bounce 1.4s infinite ease-in-out}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}.chat-input-area[_ngcontent-%COMP%]{padding:.7rem;border-top:1px solid #ddd;background:#fff;border-radius:0 0 13px 13px}.context-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem;padding:.3rem .5rem;background:#e8f5e9;border-radius:5px}.context-bar[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#2e7d32;font-size:.7rem}.input-row[_ngcontent-%COMP%]{display:flex;gap:.5rem}.chat-input[_ngcontent-%COMP%]{flex:1;padding:.7rem;border:2px solid #ddd;border-radius:20px;font-size:.85rem;outline:none}.chat-input[_ngcontent-%COMP%]:focus{border-color:#4caf50}.send-btn[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;border:none;cursor:pointer;font-size:1rem}.send-btn[_ngcontent-%COMP%]:disabled{opacity:.5}.command-hints[_ngcontent-%COMP%]{margin-top:.3rem;text-align:center}.command-hints[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#888;font-size:.65rem}@keyframes _ngcontent-%COMP%_pulse-badge{0%,to{transform:scale(1)}50%{transform:scale(1.2)}}@keyframes _ngcontent-%COMP%_pulse-dot{0%,to{opacity:1}50%{opacity:.5}}.message-actions[_ngcontent-%COMP%]{margin-top:.5rem;display:flex;flex-wrap:wrap;gap:.3rem}.action-btn[_ngcontent-%COMP%]{padding:.3rem .6rem;background:#fff3;border:1px solid rgba(255,255,255,.3);color:inherit;border-radius:12px;cursor:pointer;font-size:.75rem}.action-btn.completed[_ngcontent-%COMP%]{background:#4caf504d}.action-btn.failed[_ngcontent-%COMP%]{background:#f443364d}.spinner[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.nutrient-highlight[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin:.5rem 0;flex-wrap:wrap}.nutrient-badge[_ngcontent-%COMP%]{padding:.3rem .6rem;border-radius:15px;font-size:.7rem;font-weight:600;display:flex;align-items:center;gap:.3rem}.nutrient-badge.iron[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:#fff}.nutrient-badge.vitamin-d[_ngcontent-%COMP%]{background:linear-gradient(135deg,#feca57,#ff9ff3);color:#fff}.nutrient-badge.protein[_ngcontent-%COMP%]{background:linear-gradient(135deg,#48dbfb,#0abde3);color:#fff}.meal-suggestions[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1rem;margin:.5rem 0;box-shadow:0 4px 12px #0000001a;border:2px solid #4CAF50}.meal-suggestions[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:#2e7d32;font-size:1.1rem;text-align:center}.suggestion-card[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #e0e0e0;border-radius:12px;padding:1rem;margin-bottom:1rem;transition:all .3s ease;cursor:pointer}.suggestion-card[_ngcontent-%COMP%]:hover{border-color:#4caf50;box-shadow:0 4px 12px #4caf5033;transform:translateY(-2px)}.suggestion-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem}.suggestion-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#333;font-weight:600}.meal-stats[_ngcontent-%COMP%]{display:flex;gap:.5rem;font-size:.75rem}.meal-stats[_ngcontent-%COMP%]   .calories[_ngcontent-%COMP%]{background:#4caf50;color:#fff;padding:.2rem .5rem;border-radius:8px}.meal-stats[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{background:#ff9800;color:#fff;padding:.2rem .5rem;border-radius:8px}.nutrition-preview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem;margin-bottom:.8rem}.nutrition-preview[_ngcontent-%COMP%]   .nutrient[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:.8rem}.nutrition-preview[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#666;font-weight:500}.nutrition-preview[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:600;color:#333}.nutrition-preview[_ngcontent-%COMP%]   .value.low-carb[_ngcontent-%COMP%]{color:#4caf50;font-weight:700}.foods-list[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.85rem;color:#555}.foods-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1rem;font-size:.8rem}.foods-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.3rem;color:#444}.foods-list[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#888;font-style:italic}.suggestion-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem}.btn-log-meal[_ngcontent-%COMP%], .btn-add-foods[_ngcontent-%COMP%]{flex:1;padding:.7rem;border:none;border-radius:8px;cursor:pointer;font-size:.85rem;font-weight:600;transition:all .2s ease}.btn-log-meal[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff}.btn-log-meal[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#2e7d32,#1b5e20);transform:translateY(-1px)}.btn-add-foods[_ngcontent-%COMP%]{background:#f0f0f0;color:#333;border:1px solid #ddd}.btn-add-foods[_ngcontent-%COMP%]:hover{background:#e0e0e0;border-color:#ccc}.chat-ul[_ngcontent-%COMP%]{margin:.5rem 0;padding-left:1.5rem;list-style-type:none}.chat-li[_ngcontent-%COMP%]{position:relative;margin-bottom:.4rem;line-height:1.4}.chat-li[_ngcontent-%COMP%]:before{content:"\\2022";color:#764ba2;font-weight:700;position:absolute;left:-1rem}.agent-mode[_ngcontent-%COMP%]   .chat-li[_ngcontent-%COMP%]:before{color:#4caf50}']});let a=g;return a})();var et=()=>({exact:!0}),de=(()=>{let g=class g{constructor(){this.title="Makla"}};g.\u0275fac=function(e){return new(e||g)},g.\u0275cmp=O({type:g,selectors:[["app-root"]],decls:40,vars:2,consts:[[1,"app-container"],[1,"header"],[1,"header-content"],[1,"logo"],[1,"nav"],["routerLink","/","routerLinkActive","active",3,"routerLinkActiveOptions"],[1,"icon"],["routerLink","/ai-assistant","routerLinkActive","active"],["routerLink","/foods","routerLinkActive","active"],["routerLink","/meals","routerLinkActive","active"],["routerLink","/water","routerLinkActive","active"],["routerLink","/diagnostic","routerLinkActive","active"],["routerLink","/settings","routerLinkActive","active"],[1,"main-content"],[1,"footer"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1",3),s(4,"\u{1F34E} MAKLA"),i(),o(5,"nav",4)(6,"a",5)(7,"span",6),s(8,"\u{1F3E0}"),i(),s(9," Dashboard "),i(),o(10,"a",7)(11,"span",6),s(12,"\u{1F916}"),i(),s(13," AI Assistant "),i(),o(14,"a",8)(15,"span",6),s(16,"\u{1F34E}"),i(),s(17," Aliments "),i(),o(18,"a",9)(19,"span",6),s(20,"\u{1F37D}\uFE0F"),i(),s(21," Repas "),i(),o(22,"a",10)(23,"span",6),s(24,"\u{1F4A7}"),i(),s(25," Hydratation "),i(),o(26,"a",11)(27,"span",6),s(28,"\u{1F50D}"),i(),s(29," Diagnostic "),i(),o(30,"a",12)(31,"span",6),s(32,"\u2699\uFE0F"),i(),s(33," Settings "),i()()()(),o(34,"main",13),S(35,"router-outlet"),i(),S(36,"app-ai-chat"),o(37,"footer",14)(38,"p"),s(39,"\xA9 2025 Makla - Application de Nutrition"),i()()()),e&2&&(l(6),m("routerLinkActiveOptions",k(1,et)))},dependencies:[D,X,Q,K,J,ce],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.app-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;background:#f5f5f5}.header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:1rem 0;box-shadow:0 2px 10px #0000001a}.header-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center}.logo[_ngcontent-%COMP%]{font-size:2rem;font-weight:700}.nav[_ngcontent-%COMP%]{display:flex;gap:1rem}.nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:.5rem 1rem;border-radius:8px;transition:all .3s;display:flex;align-items:center;gap:.5rem}.nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:#fff3}.nav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background:#ffffff4d;font-weight:700}.icon[_ngcontent-%COMP%]{font-size:1.2rem}.main-content[_ngcontent-%COMP%]{flex:1;max-width:1200px;width:100%;margin:0 auto;padding:2rem}.footer[_ngcontent-%COMP%]{background:#2c3e50;color:#fff;text-align:center;padding:1rem}"]});let a=g;return a})();var ge=[{path:"",loadComponent:()=>import("./chunk-LBJPVNEI.js").then(a=>a.EnhancedDashboardComponent)},{path:"dashboard",loadComponent:()=>import("./chunk-LBJPVNEI.js").then(a=>a.EnhancedDashboardComponent)},{path:"classic-dashboard",loadComponent:()=>import("./chunk-OWQZP5WN.js").then(a=>a.DashboardComponent)},{path:"login",loadComponent:()=>import("./chunk-YMUUZDD4.js").then(a=>a.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-HX2XAOD2.js").then(a=>a.RegisterComponent)},{path:"meals",loadComponent:()=>import("./chunk-5A357GZV.js").then(a=>a.MealsComponent)},{path:"water",loadComponent:()=>import("./chunk-TO46CGQZ.js").then(a=>a.WaterComponent)},{path:"foods",loadComponent:()=>import("./chunk-3OF7EYZZ.js").then(a=>a.FoodsComponent)},{path:"analysis",loadComponent:()=>import("./chunk-PYEKSQRX.js").then(a=>a.AnalysisComponent)},{path:"diagnostic",loadComponent:()=>import("./chunk-OEN6IJLR.js").then(a=>a.DiagnosticComponent)},{path:"home",loadComponent:()=>import("./chunk-55D7NIFS.js").then(a=>a.HomeComponent)},{path:"ai-assistant",loadComponent:()=>import("./chunk-GNWXNGT7.js").then(a=>a.AiAssistantComponent)},{path:"settings",loadComponent:()=>import("./chunk-G7LVF5SU.js").then(a=>a.SettingsComponent)},{path:"**",redirectTo:"dashboard"}];var me={providers:[j({eventCoalescing:!0}),Z(ge),H(N())]};q(de,me).catch(a=>console.error(a));
