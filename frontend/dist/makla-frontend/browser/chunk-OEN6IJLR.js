import{a as f}from"./chunk-2LUDLJ2U.js";import{$a as v,Ga as h,La as _,Nb as x,Ob as b,Pa as d,Pb as E,Sb as P,Wa as l,Xa as n,Xb as M,Ya as t,ab as C,d as u,ib as i,jb as p,kb as g,wa as r}from"./chunk-OOT27GPI.js";function O(o,a){o&1&&(n(0,"span"),i(1,"\u23F3"),t())}function S(o,a){o&1&&(n(0,"span"),i(1,"\u2705"),t())}function D(o,a){o&1&&(n(0,"span"),i(1,"\u274C"),t())}function y(o,a){if(o&1&&(n(0,"p",15),i(1),t()),o&2){let c=C().$implicit;r(),g(" \u26A1 ",c.responseTime,"ms ")}}function k(o,a){if(o&1&&(n(0,"div",7)(1,"div",8)(2,"h3"),i(3),t(),n(4,"span",9),d(5,O,2,0,"span",10)(6,S,2,0,"span",10)(7,D,2,0,"span",10),t()(),n(8,"div",11)(9,"p",12),i(10),t(),n(11,"p",13),i(12),t(),d(13,y,2,1,"p",14),t()()),o&2){let c=a.$implicit;l("ngClass",c.status),r(3),p(c.name),r(),l("ngClass",c.status),r(),l("ngIf",c.status==="checking"),r(),l("ngIf",c.status==="success"),r(),l("ngIf",c.status==="error"),r(3),p(c.url),r(),l("ngClass",c.status),r(),p(c.message),r(),l("ngIf",c.responseTime)}}function I(o,a){o&1&&(n(0,"div",16)(1,"h3"),i(2,"\u{1F4A1} Recommandations"),t(),n(3,"div",17)(4,"p")(5,"strong"),i(6,"Services en erreur d\xE9tect\xE9s !"),t()(),n(7,"ol")(8,"li"),i(9,"V\xE9rifiez que tous les services sont d\xE9marr\xE9s"),t(),n(10,"li"),i(11,"Consultez Eureka Dashboard : "),n(12,"a",18),i(13,"http://localhost:8761"),t()(),n(14,"li"),i(15,"V\xE9rifiez les logs des services dans les terminaux"),t(),n(16,"li"),i(17,"Si n\xE9cessaire, red\xE9marrez tous les services avec "),n(18,"code"),i(19,"START-ALL-SERVICES.ps1"),t()()()()())}function w(o,a){o&1&&(n(0,"div",19)(1,"h3"),i(2,"\u{1F389} Tous les services fonctionnent correctement !"),t(),n(3,"p"),i(4,"Vous pouvez commencer \xE0 utiliser l'application."),t()())}var R=(()=>{let a=class a{constructor(e){this.http=e,this.apiUrl=f.apiUrl,this.environment=f,this.testing=!1,this.hasErrors=!1,this.allSuccess=!1,this.services=[{name:"API Gateway",url:"http://localhost:8080/actuator/health",status:"checking",message:"En attente..."},{name:"Eureka Server",url:"http://localhost:8761/actuator/health",status:"checking",message:"En attente..."},{name:"Meal Service (direct)",url:"http://localhost:8084/api/meals",status:"checking",message:"En attente..."},{name:"Water Service (direct)",url:"http://localhost:8085/api/water",status:"checking",message:"En attente..."},{name:"Meal Service (via Gateway)",url:"http://localhost:8080/api/meals",status:"checking",message:"En attente..."},{name:"Water Service (via Gateway)",url:"http://localhost:8080/api/water",status:"checking",message:"En attente..."}]}ngOnInit(){setTimeout(()=>this.runDiagnostics(),500)}runDiagnostics(){return u(this,null,function*(){this.testing=!0,this.hasErrors=!1,this.allSuccess=!1,this.services.forEach(e=>{e.status="checking",e.message="Test en cours...",e.responseTime=void 0});for(let e of this.services)yield this.testService(e);this.testing=!1,this.hasErrors=this.services.some(e=>e.status==="error"),this.allSuccess=this.services.every(e=>e.status==="success")})}testService(e){return u(this,null,function*(){let m=Date.now();try{let s=yield this.http.get(e.url,{observe:"response"}).toPromise();e.responseTime=Date.now()-m,e.status="success",e.message="Service op\xE9rationnel",e.url.includes("localhost:8080")&&(e.message+=" (via API Gateway \u2713)")}catch(s){e.responseTime=Date.now()-m,e.status="error",s.status===0?e.url.includes("localhost:8080")?e.message=`\u274C Gateway ne route pas vers ce service. V\xE9rifiez:
1. Service enregistr\xE9 dans Eureka?
2. Gateway red\xE9marr\xE9e apr\xE8s les services?`:e.message="\u274C Service inaccessible - V\xE9rifiez qu'il est d\xE9marr\xE9":s.status===404?e.url.includes("localhost:8080")?e.message="\u274C Route non configur\xE9e dans Gateway ou service non trouv\xE9":e.message="\u274C Endpoint non trouv\xE9 - V\xE9rifiez l'URL":s.status===400?e.message="\u274C Erreur CORS - Configuration Gateway incorrecte":s.status===500?e.message="\u274C Erreur interne du service - V\xE9rifiez les logs":s.status===503?e.message="\u274C Service temporairement indisponible":e.message=`\u274C Erreur HTTP ${s.status}: ${s.statusText||"Erreur inconnue"}`,s.error&&typeof s.error=="string"&&(e.message+=`
D\xE9tails: ${s.error.substring(0,100)}`)}})}};a.\u0275fac=function(m){return new(m||a)(h(M))},a.\u0275cmp=_({type:a,selectors:[["app-diagnostic"]],decls:20,vars:7,consts:[[1,"diagnostic-page"],[1,"info-box"],[1,"btn-test",3,"click","disabled"],[1,"services-grid"],["class","service-card",3,"ngClass",4,"ngFor","ngForOf"],["class","recommendations",4,"ngIf"],["class","success-box",4,"ngIf"],[1,"service-card",3,"ngClass"],[1,"service-header"],[1,"status-badge",3,"ngClass"],[4,"ngIf"],[1,"service-details"],[1,"url"],[1,"message",3,"ngClass"],["class","response-time",4,"ngIf"],[1,"response-time"],[1,"recommendations"],[1,"recommendation-box"],["href","http://localhost:8761","target","_blank"],[1,"success-box"]],template:function(m,s){m&1&&(n(0,"div",0)(1,"h1"),i(2,"\u{1F50D} Diagnostic des Services"),t(),n(3,"div",1)(4,"h3"),i(5,"\u{1F4CB} Configuration"),t(),n(6,"p")(7,"strong"),i(8,"API URL:"),t(),i(9),t(),n(10,"p")(11,"strong"),i(12,"Environnement:"),t(),i(13),t()(),n(14,"button",2),v("click",function(){return s.runDiagnostics()}),i(15),t(),n(16,"div",3),d(17,k,14,10,"div",4),t(),d(18,I,20,0,"div",5)(19,w,5,0,"div",6),t()),m&2&&(r(9),g(" ",s.apiUrl),r(4),g(" ",s.environment.production?"Production":"D\xE9veloppement"),r(),l("disabled",s.testing),r(),g(" ",s.testing?"\u23F3 Test en cours...":"\u{1F504} Lancer les tests"," "),r(2),l("ngForOf",s.services),r(),l("ngIf",s.hasErrors),r(),l("ngIf",s.allSuccess))},dependencies:[P,x,b,E],styles:[".diagnostic-page[_ngcontent-%COMP%]{padding:2rem;animation:_ngcontent-%COMP%_fadeIn .5s}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}h1[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:1.5rem;font-size:2rem}.info-box[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:10px;box-shadow:0 2px 8px #0000001a;margin-bottom:1.5rem}.info-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#667eea;margin-bottom:1rem}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;color:#2c3e50}.btn-test[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:1rem 2rem;border:none;border-radius:10px;font-size:1.1rem;cursor:pointer;margin-bottom:2rem;transition:transform .3s}.btn-test[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px)}.btn-test[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.services-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1.5rem;margin-bottom:2rem}.service-card[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:10px;box-shadow:0 2px 8px #0000001a;border-left:4px solid #ddd;transition:all .3s}.service-card.checking[_ngcontent-%COMP%]{border-left-color:#f39c12}.service-card.success[_ngcontent-%COMP%]{border-left-color:#27ae60}.service-card.error[_ngcontent-%COMP%]{border-left-color:#e74c3c}.service-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.service-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:1.2rem}.status-badge[_ngcontent-%COMP%]{font-size:1.5rem}.service-details[_ngcontent-%COMP%]   .url[_ngcontent-%COMP%]{color:#7f8c8d;font-size:.9rem;margin-bottom:.5rem;word-break:break-all}.service-details[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin:.5rem 0;font-weight:500}.message.checking[_ngcontent-%COMP%]{color:#f39c12}.message.success[_ngcontent-%COMP%]{color:#27ae60}.message.error[_ngcontent-%COMP%]{color:#e74c3c}.response-time[_ngcontent-%COMP%]{color:#667eea;font-size:.9rem;font-weight:600}.recommendations[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;padding:1.5rem;border-radius:10px;margin-bottom:1.5rem}.recommendations[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#856404;margin-bottom:1rem}.recommendation-box[_ngcontent-%COMP%]{color:#856404}.recommendation-box[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin-left:1.5rem;margin-top:1rem}.recommendation-box[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.5rem 0}.recommendation-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#667eea;text-decoration:none;font-weight:600}.recommendation-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.recommendation-box[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#f8f9fa;padding:.25rem .5rem;border-radius:4px;font-family:monospace}.success-box[_ngcontent-%COMP%]{background:#d4edda;border:1px solid #28a745;padding:1.5rem;border-radius:10px;text-align:center}.success-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#155724;margin-bottom:.5rem}.success-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#155724;margin:0}"]});let o=a;return o})();export{R as DiagnosticComponent};
