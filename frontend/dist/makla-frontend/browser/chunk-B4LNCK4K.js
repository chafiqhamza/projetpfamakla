import{a as m}from"./chunk-2LUDLJ2U.js";import{A as c,M as n,Q as u,U as I,Xb as g,a as p,b as h,k as s,s as i}from"./chunk-OOT27GPI.js";var j=(()=>{let o=class o{constructor(e){this.http=e,this.apiUrl=m.waterServiceUrl||`${m.apiUrl}/water`,this.waterIntakesSubject=new s([]),this.waterIntakes$=this.waterIntakesSubject.asObservable()}getAllWaterIntakes(){return this.http.get(this.apiUrl).pipe(i(e=>e.map(t=>({id:t.id,amount:t.amountMl,date:t.intakeTime||t.createdAt,time:t.intakeTime||t.createdAt}))),n(e=>this.waterIntakesSubject.next(e)))}getWaterIntakeById(e){return this.http.get(`${this.apiUrl}/${e}`).pipe(i(t=>({id:t.id,amount:t.amountMl,date:t.intakeTime||t.createdAt,time:t.intakeTime||t.createdAt})))}getTodayIntake(){let e=new Date().toISOString().split("T")[0];return this.http.get(`${this.apiUrl}/today`).pipe(i(t=>({totalAmount:t.totalAmount||0,intakes:(t.intakes||[]).map(a=>({id:a.id,amount:a.amountMl,date:a.intakeTime||a.createdAt,time:a.intakeTime||a.createdAt}))})),n(t=>{this.waterIntakesSubject.next(t.intakes)}),c(t=>{console.warn("getTodayIntake failed, falling back to local water",t);let d=(JSON.parse(localStorage.getItem("local_water")||"[]")||[]).filter(r=>(r.date||"").startsWith(e)).map(r=>({id:r.id,amount:r.amount,date:r.date,time:r.date}));this.waterIntakesSubject.next(d);let f=d.reduce((r,y)=>r+(y.amount||0),0);return new s({totalAmount:f,intakes:d})}))}addWaterIntake(e){let t={amountMl:e.amount,intakeTime:e.date||new Date().toISOString(),notes:""};return this.http.post(this.apiUrl,t).pipe(i(a=>({id:a.id,amount:a.amountMl,date:a.intakeTime||a.createdAt,time:a.intakeTime||a.createdAt})),n(()=>this.refreshTodayIntake()),c(a=>(console.warn("addWaterIntake failed, saving locally",a),this.saveWaterLocallyAndReturn(e))))}deleteWaterIntake(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(n(()=>this.refreshTodayIntake()))}getTodayTotal(){let e=new Date().toISOString().split("T")[0];return this.http.get(`${this.apiUrl}/total/${e}`)}refreshTodayIntake(){this.getTodayIntake().subscribe()}saveWaterLocallyAndReturn(e){let t=JSON.parse(localStorage.getItem("local_water")||"[]"),a=h(p({},e),{id:Date.now(),date:e.date||new Date().toISOString()});return t.push(a),localStorage.setItem("local_water",JSON.stringify(t)),this.refreshTodayIntake(),new s(a)}};o.\u0275fac=function(t){return new(t||o)(I(g))},o.\u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"});let l=o;return l})();export{j as a};
